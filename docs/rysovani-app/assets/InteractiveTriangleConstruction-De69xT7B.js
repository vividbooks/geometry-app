import{r as l,j as y,A as st}from"./index-DaXuR-EO.js";import{u as ot,F as it}from"./slider-B4nctQKA.js";import{B as rt}from"./BigNumberInput-hGtmu-Lv.js";import{C as at,a as lt}from"./ConstructionStepLog-Ve-lt4Yy.js";function pt({onBack:ue,darkMode:m,onDarkModeChange:Te}){const Re=ot(),C=l.useRef(null),B=l.useRef(null),F=l.useRef(null),V=l.useRef(),[a,he]=l.useState(0),[p,J]=l.useState(Re?.2:.4),[g,M]=l.useState({x:0,y:0}),[Q,Z]=l.useState(!1),[q,de]=l.useState({x:0,y:0}),[b,Me]=l.useState({width:1920,height:1080}),[R,ee]=l.useState(0),[fe,te]=l.useState(!0),[x,Xe]=l.useState(!0),[X,ne]=l.useState(!1),se=[{notation:"AB",description:"Narýsuj stranu AB",type:"segment"},{notation:"A",description:"Zapíchni kružítko do bodu A",type:"point"},{notation:"k(A, AC)",description:"Narýsuj kružnici z bodu A",type:"circle"},{notation:"B",description:"Zapíchni kružítko do bodu B",type:"point"},{notation:"k(B, BC)",description:"Narýsuj kružnici z bodu B",type:"circle"},{notation:"C = k(A, AC) ∩ k(B, BC)",description:"Označ průsečík jako bod C",type:"point"},{notation:"AC, BC",description:"Dorýsuj trojúhelník",type:"segment"},{notation:"ABC",description:"Opsat trojúhelník",type:"segment"}],oe=l.useRef(null),[Ye,De]=l.useState(!1),ie=l.useRef(null),[ze,Ne]=l.useState(!1),[u,me]=l.useState({x:860,y:900}),[d,ge]=l.useState({x:1460,y:900}),[L,Y]=l.useState(null),[O,re]=l.useState(null),[pe,Ee]=l.useState(!1),[Le,ye]=l.useState(!1),[We,$e]=l.useState(0),[Fe,Ze]=l.useState(1),[ct,qe]=l.useState({x:0,y:0}),[w,be]=l.useState(null),[A,ve]=l.useState(null),[S,we]=l.useState(null),[Ae,D]=l.useState(""),[j,T]=l.useState(!0),ae=Math.sqrt(Math.pow(d.x-u.x,2)+Math.pow(d.y-u.y,2)),W=A&&w?ae*(A/w):0,$=S&&w?ae*(S/w):0,v=(()=>{if(!A||!S||!w)return null;const e=ae,t=W,n=$;if(e>t+n||e<Math.abs(t-n)||e===0)return null;const s=(e*e+t*t-n*n)/(2*e),o=t*t-s*s;if(o<0)return null;const i=Math.sqrt(o),r=u.x+(d.x-u.x)*(s/e),c=u.y+(d.y-u.y)*(s/e),h=d.x-u.x,k=-(d.y-u.y)/e,P=h/e;return{top:{x:r+i*k,y:c+i*P},bottom:{x:r-i*k,y:c-i*P}}})();l.useEffect(()=>{B.current||(B.current=document.createElement("canvas"))},[]),l.useEffect(()=>{const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{oe.current=e,De(!0)},e.onerror=()=>console.error("Failed to load ruler image"),e.src="https://jjpiguuubvmiobmixwgh.supabase.co/storage/v1/object/public/Admin%20math/pravitko4.svg"},[]),l.useEffect(()=>{const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{ie.current=e,Ne(!0)},e.onerror=()=>console.error("Failed to load compass image"),e.src="https://jjpiguuubvmiobmixwgh.supabase.co/storage/v1/object/public/Admin%20math/kruzitko.svg"},[]);const _=(e,t)=>({x:(e-g.x)/p,y:(t-g.y)/p}),z=(e,t,n=15)=>{const s=e.x-t.x,o=e.y-t.y;return Math.sqrt(s*s+o*o)<n},N=(e,t,n)=>{const s=e.x*p+g.x,o=e.y*p+g.y,i=s+n.x,r=o+n.y,c=20,h=t.x-i,f=t.y-(r-8);return Math.sqrt(h*h+f*f)<c},Se=()=>{if(!b.width||!b.height)return;const e=(u.x+d.x)/2,t=u.y,n=b.width/2,s=b.height/2;M({x:n-e*p,y:s-t*p})};l.useEffect(()=>{const e=()=>{F.current&&Me({width:F.current.clientWidth,height:F.current.clientHeight})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),l.useEffect(()=>{b.width>0&&b.height>0&&(Se(),pe||Ee(!0))},[b.width,b.height,pe]),l.useEffect(()=>{const e=C.current,t=B.current;if(!e||!t)return;const n=window.devicePixelRatio||1;e.width=b.width*n,e.height=b.height*n,t.width=b.width*n,t.height=b.height*n},[b]),l.useEffect(()=>(fe&&R<1&&!j?V.current=requestAnimationFrame(()=>{let e=.009;a===1||a===3?e=.003:(a===2||a===4)&&(e=.006),ee(t=>Math.min(t+e,1))}):R>=1&&te(!1),()=>{V.current&&cancelAnimationFrame(V.current)}),[fe,R,a,j]);const Oe=()=>{if(D(""),a===0){if(w===null||w<0){D("Zadej prosím platnou délku (0-99 cm)");return}if(w===0){D("Délka strany musí být větší než 0 cm");return}T(!1)}else if(a===1){if(A===null||A<=0){D("Zadej prosím kladné číslo větší než 0");return}T(!1)}else if(a===3){if(S===null||S<=0){D("Zadej prosím kladné číslo větší než 0");return}T(!1)}},_e=e=>{let t=50*p;for(;t<35;)t*=2;e.strokeStyle=m?"rgba(125, 107, 194, 0.15)":"rgba(229, 231, 235, 0.8)",e.lineWidth=1;const n=g.x%t,s=g.y%t;for(let o=n;o<=b.width;o+=t)e.beginPath(),e.moveTo(o,0),e.lineTo(o,b.height),e.stroke();for(let o=s;o<=b.height;o+=t)e.beginPath(),e.moveTo(0,o),e.lineTo(b.width,o),e.stroke()},K=(e,t,n,s="#000",o=12,i=-12,r=1)=>{e.save(),e.setTransform(r,0,0,r,0,0);const c=t.x*p+g.x,h=t.y*p+g.y;e.font="bold 16px Inter, system-ui, sans-serif";const k=e.measureText(n).width,P=8,I=c+o+k/2,G=h+i-8,nt=Math.max(k,16)/2+P;e.fillStyle="#3b82f6",e.beginPath(),e.arc(I,G,nt,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff",e.textAlign="center",e.textBaseline="middle",e.fillText(n,I,G),e.restore()},ke=(e,t,n,s="#000",o=!1)=>{const i=o?24:20,r=n+Math.PI/2,c={x:t.x+Math.cos(r)*i/2,y:t.y+Math.sin(r)*i/2},h={x:t.x-Math.cos(r)*i/2,y:t.y-Math.sin(r)*i/2};e.strokeStyle=s,e.lineWidth=6,e.lineCap="butt",e.beginPath(),e.moveTo(c.x,c.y),e.lineTo(h.x,h.y),e.stroke(),o&&(e.fillStyle=m?"rgba(96, 165, 250, 0.25)":"rgba(59, 130, 246, 0.15)",e.beginPath(),e.arc(t.x,t.y,18,0,Math.PI*2),e.fill())},xe=(e,t,n,s="#000")=>{e.fillStyle=m?"rgba(75, 85, 99, 0.4)":"rgba(200, 200, 200, 0.3)",e.beginPath(),e.arc(t.x,t.y,10,0,Math.PI*2),e.fill(),e.fillStyle=s,e.beginPath(),e.arc(t.x,t.y,7,0,Math.PI*2),e.fill(),e.strokeStyle=m?"#111827":"#ffffff",e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,7,0,Math.PI*2),e.stroke()},E=(e,t,n,s,o=1)=>{const i=(t.x+n.x)/2,r=(t.y+n.y)/2,c=n.x-t.x,h=n.y-t.y,f=Math.atan2(h,c);e.save(),e.setTransform(o,0,0,o,0,0);const k=i*p+g.x,P=r*p+g.y;e.translate(k,P),e.rotate(f);const I=`${s}cm`;e.font='600 18px "Fenomen Sans", Arial, sans-serif',e.fillStyle=m?"#e5e7eb":"#1f2937",e.textAlign="center",e.textBaseline="bottom",e.fillText(I,0,-8),e.restore()},H=(e,t,n,s="#000",o=2,i=1)=>{let r=0;i<=.15?r=0:i>=.85?r=1:r=(i-.15)/.7;const c={x:t.x+(n.x-t.x)*r,y:t.y+(n.y-t.y)*r},h=r<1;h&&r>0&&(e.strokeStyle="rgba(251, 191, 36, 0.5)",e.lineWidth=o*10,e.lineCap="round",e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(c.x,c.y),e.stroke()),r>0&&(e.strokeStyle=s,e.lineWidth=h?o*1.5:o,e.lineCap="round",e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(c.x,c.y),e.stroke())},je=(e,t,n,s="#93c5fd",o=2,i=1)=>{let r=0;i<=.15?r=0:i>=.85?r=1:r=(i-.15)/.7;const c=Math.PI*2*r,h=r<1;h&&r>0&&(e.strokeStyle="rgba(251, 191, 36, 0.5)",e.lineWidth=o*10,e.lineCap="round",e.beginPath(),e.arc(t.x,t.y,n,0,c),e.stroke()),r>0&&(e.strokeStyle=s,e.lineWidth=h?o*1.5:o,e.lineCap="round",e.beginPath(),e.arc(t.x,t.y,n,0,c),e.stroke())},le=(e,t,n,s)=>{if(!x||!Ye||!oe.current)return;let o=0;if(s<.15)o=s/.15;else if(s>=.15&&s<=.85)o=1;else if(s>.85&&s<1)o=(1-s)/.15;else return;const i=oe.current,r=800,c=400;e.save();const h=n.x-t.x,f=n.y-t.y,k=Math.sqrt(h*h+f*f),P=Math.atan2(f,h);e.translate(t.x,t.y),e.rotate(P),e.globalAlpha=o;const I=k/2-r/2;e.drawImage(i,I,-c,r,c),e.restore()},U=(e,t,n,s,o)=>{if(!x||!ze||!ie.current)return;let i=0;if(s<.15)i=s/.15;else if(s>=.15&&s<=.85)i=1;else if(s>.85&&s<1)i=(1-s)/.15;else return;const r=ie.current,c=n,h=n;e.save(),e.translate(t.x,t.y),e.rotate(o),e.globalAlpha=i,e.drawImage(r,0,-h,c,h),e.restore()},ce=(()=>{switch(a){case 0:return{title:"Narýsuj stranu AB",description:j?"Kolik centimetrů má mít strana AB?":`Rýsujeme stranu AB = ${w} cm. Body A a B můžeš přesouvat myší!`,needsInput:j,inputLabel:"Délka strany AB (cm)"};case 1:return{title:"Zapíchni kružítko do bodu A",description:j?"Kolik centimetrů má mít strana AC?":`Zapíchneme kružítko do bodu A a vezmeme do něj délku AC = ${A} cm.`,needsInput:j,inputLabel:"Délka strany AC (cm)"};case 2:return{title:"Narýsuj kružnici z bodu A",description:`Rýsujeme kružnici z bodu A s poloměrem AC = ${A} cm.`,needsInput:!1};case 3:return{title:"Zapíchni kružítko do bodu B",description:j?"Kolik centimetrů má mít strana BC?":`Zapíchneme kružítko do bodu B a vezmeme do něj délku BC = ${S} cm.`,needsInput:j,inputLabel:"Délka strany BC (cm)"};case 4:return{title:"Narýsuj kružnici z bodu B",description:`Rýsujeme kružnici z bodu B s poloměrem BC = ${S} cm.`,needsInput:!1};case 5:return v?{title:"Označ průsečík jako bod C",description:"Bod, ve kterém se kružnice protly, pojmenujeme C. To je třetí vrchol trojúhelníku.",needsInput:!1}:{title:"Kružnice se neprotly! ❌",description:"Tyto strany netvoří trojúhelník. Součet dvou stran musí být větší než třetí strana.",needsInput:!1,error:!0};case 6:return{title:"Dorýsuj trojúhelník",description:"Spojíme body A-C a B-C. Trojúhelník ABC je hotový!",needsInput:!1};case 7:return{title:"Opsat trojúhelník",description:"Připíšeme délky stran.",needsInput:!1};default:return{title:"",description:"",needsInput:!1}}})(),Ke=(e,t)=>{const n=window.devicePixelRatio||1;if(!B.current||B.current.width===0||B.current.height===0)return;e.clearRect(0,0,B.current.width,B.current.height),e.save(),e.scale(n,n),_e(e),e.translate(g.x,g.y),e.scale(p,p);const s=window.devicePixelRatio||1,o=Math.atan2(d.y-u.y,d.x-u.x),i=m?"#e5e7eb":"#1f2937",r=m?"#93c5fd":"#3b82f6",c=m?"#fca5a5":"#ef4444",h=m?"#6ee7b7":"#10b981";if(a>=0&&w&&(H(e,u,d,i,6,a===0&&!j?t:1),ke(e,u,o,i,O==="A"),ke(e,d,o,i,O==="B"),K(e,u,"A",i,-25,-12,s),K(e,d,"B",i,12,-12,s),a===0&&!j&&x&&le(e,u,d,t),(a>0||a===0&&!j&&t>.85)&&x&&E(e,u,d,w,s)),a>=1&&A&&W>0&&(a===1&&!j&&x&&U(e,u,W,t,0),a>=2&&(je(e,u,W,r,4,a===2?t:1),a===2&&x))){const k=t>.15?Math.PI*2*((t-.15)/.7):0;U(e,u,W,t,k)}if(a>=3&&S&&$>0&&(a===3&&!j&&x&&U(e,d,$,t,0),a>=4&&(je(e,d,$,r,4,a===4?t:1),a===4&&x))){const k=t>.15?Math.PI*2*((t-.15)/.7):0;U(e,d,$,t,k)}if(a>=5&&v)if(a===5&&t>.3){const f=Math.min((t-.3)/.7,1);e.globalAlpha=f,xe(e,v.top,"C",c),e.globalAlpha=1,f>.5&&K(e,v.top,"C",c,12,-12,s)}else a>=6&&(xe(e,v.top,"C",c),K(e,v.top,"C",c,12,-12,s));if(a>=6&&v&&A&&S){const f=t*2;f<=1?(H(e,u,v.top,h,5,f),x&&le(e,u,v.top,f)):(H(e,u,v.top,h,5,1),H(e,d,v.top,h,5,f-1),x&&le(e,d,v.top,f-1)),(a>6||a===6&&t>.85)&&x&&(E(e,u,v.top,A,s),E(e,d,v.top,S,s))}a>=7&&v&&w&&A&&S&&x&&t>0&&(e.globalAlpha=Math.min(t/.3,1),E(e,u,d,w,s),t>.3&&(e.globalAlpha=Math.min((t-.3)/.3,1),E(e,u,v.top,A,s)),t>.6&&(e.globalAlpha=Math.min((t-.6)/.3,1),E(e,d,v.top,S,s)),e.globalAlpha=1),e.restore()};l.useEffect(()=>{const e=C.current,t=B.current;if(!e||!t||e.width===0||e.height===0||t.width===0||t.height===0)return;const n=e.getContext("2d"),s=t.getContext("2d");if(!n||!s)return;Ke(s,R),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,e.width,e.height);const o=R<.05?R/.05:1;n.globalAlpha=o,n.drawImage(t,0,0),n.globalAlpha=1},[a,p,g,b,u,d,O,R,x,m,w,A,S,j]);const He=e=>{e>a&&(a===0&&!w||a===1&&!A||a===3&&!S||a===5&&!v)||(he(e),ee(0),te(!0),T(e===0&&!w||e===1&&!A?!0:e===3&&!S))},Ue=e=>{const t=C.current?.getBoundingClientRect();if(!t)return;const n=e.clientX-t.left,s=e.clientY-t.top,o=_(n,s),i={x:n,y:s};if(z(u,o)||N(u,i,{x:-25,y:-12})){Y("A");return}if(z(d,o)||N(d,i,{x:12,y:-12})){Y("B");return}Z(!0),de({x:e.clientX-g.x,y:e.clientY-g.y})},Ge=e=>{const t=C.current?.getBoundingClientRect();if(!t)return;const n=e.clientX-t.left,s=e.clientY-t.top,o=_(n,s),i={x:n,y:s};if(L==="A"){me(o);return}if(L==="B"){ge(o);return}if(Q){M({x:e.clientX-q.x,y:e.clientY-q.y});return}z(u,o)||N(u,i,{x:-25,y:-12})?re("A"):z(d,o)||N(d,i,{x:12,y:-12})?re("B"):re(null)},Pe=()=>{Z(!1),Y(null)},Be=(e,t)=>{const n=e.clientX-t.clientX,s=e.clientY-t.clientY;return Math.sqrt(n*n+s*s)},Ie=(e,t)=>({x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2}),Ve=e=>{const t=C.current?.getBoundingClientRect();if(!t)return;if(e.touches.length===2){const c=Be(e.touches[0],e.touches[1]),h=Ie(e.touches[0],e.touches[1]);ye(!0),$e(c),Ze(p),qe(h),e.preventDefault();return}if(e.touches.length!==1)return;const n=e.touches[0],s=n.clientX-t.left,o=n.clientY-t.top,i=_(s,o),r={x:s,y:o};if(z(u,i)||N(u,r,{x:-25,y:-12})){Y("A"),e.preventDefault();return}if(z(d,i)||N(d,r,{x:12,y:-12})){Y("B"),e.preventDefault();return}Z(!0),de({x:n.clientX-g.x,y:n.clientY-g.y}),e.preventDefault()},Je=e=>{const t=C.current?.getBoundingClientRect();if(!t)return;if(e.touches.length===2&&Le){const r=Be(e.touches[0],e.touches[1]),c=Ie(e.touches[0],e.touches[1]),h=r/We,f=Math.max(.2,Math.min(.6,Fe*h)),k=c.x-t.left,P=c.y-t.top,I=f/p,G={x:k-(k-g.x)*I,y:P-(P-g.y)*I};J(f),M(G),e.preventDefault();return}if(e.touches.length!==1)return;const n=e.touches[0],s=n.clientX-t.left,o=n.clientY-t.top,i=_(s,o);if(L==="A"){me(i),e.preventDefault();return}if(L==="B"){ge(i),e.preventDefault();return}if(Q){M({x:n.clientX-q.x,y:n.clientY-q.y}),e.preventDefault();return}},Ce=()=>{Z(!1),Y(null),ye(!1)},Qe=e=>{e.preventDefault();const t=e.deltaY>0?.9:1.1,n=Math.max(.2,Math.min(.6,p*t)),s=C.current?.getBoundingClientRect();if(!s)return;const o=s.width/2,i=s.height/2,r=n/p;M({x:o-(o-g.x)*r,y:i-(i-g.y)*r}),J(n)},et=()=>L?"grabbing":O?"move":Q?"grabbing":"grab",tt=()=>{he(0),be(null),ve(null),we(null),D(""),T(!0),ee(0),te(!0),Se()};return y.jsxs("div",{className:"size-full flex flex-col relative",children:[y.jsx("div",{ref:F,className:`flex-1 ${m?"bg-[#1a1b26]":"bg-white"}`,children:y.jsx("canvas",{ref:C,className:"w-full h-full",style:{cursor:et(),touchAction:"none"},onMouseDown:Ue,onMouseMove:Ge,onMouseUp:Pe,onMouseLeave:Pe,onTouchStart:Ve,onTouchMove:Je,onTouchEnd:Ce,onTouchCancel:Ce,onWheel:Qe})}),y.jsxs("button",{onClick:ue,onTouchEnd:e=>{e.preventDefault(),ue()},className:`absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-2 rounded-xl shadow-[0_2px_12px_rgba(0,0,0,0.08)] transition-all ${m?"bg-[#1a1b26]/90 hover:bg-[#24283b] text-[#c0caf5] border border-[#2a2b3d] backdrop-blur-sm":"bg-white/90 hover:bg-gray-50 border border-gray-200/60 backdrop-blur-sm"}`,children:[y.jsx(st,{className:"size-5"}),y.jsx("span",{className:"text-sm font-medium",children:"Menu"})]}),y.jsx("div",{className:`absolute top-4 z-10 transition-all duration-300 ${X?"right-[576px]":"right-4"}`,children:y.jsxs("button",{onClick:()=>ne(!X),onTouchEnd:e=>{e.preventDefault(),ne(!X)},className:`p-3 rounded-xl transition-all relative group/protocol ${X?m?"bg-[#7aa2f7] text-white":"bg-[#1e1b4b] text-white":m?"bg-[#24283b] hover:bg-[#414868] text-[#c0caf5]":"bg-white/90 hover:bg-gray-50 text-gray-700 shadow-[0_2px_12px_rgba(0,0,0,0.08)] border border-gray-200/60 backdrop-blur-sm"}`,title:"Zápis konstrukce",children:[y.jsx(it,{className:"size-5"}),!X&&y.jsx("div",{className:"absolute right-0 top-full mt-2 px-3 py-1.5 bg-black/80 text-white text-xs rounded-lg whitespace-nowrap opacity-0 group-hover/protocol:opacity-100 transition-opacity pointer-events-none",children:"Zápis konstrukce"})]})}),ce.needsInput&&y.jsx("div",{className:"absolute inset-0 z-20 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:y.jsx("div",{className:`w-full max-w-md mx-4 rounded-2xl border p-6 ${m?"bg-[#1a1b26] border-[#2a2b3d]":"bg-white border-gray-200"}`,style:{fontFamily:"var(--font-family, 'Fenomen Sans', sans-serif)"},children:y.jsxs("div",{className:"space-y-4",children:[y.jsx(rt,{value:a===0?w:a===1?A:a===3?S:null,onChange:e=>{a===0?be(e):a===1?ve(e):a===3&&we(e)},min:0,max:99,step:1,unit:"cm",darkMode:m,label:ce.title}),Ae&&y.jsx("div",{className:`p-3 rounded-lg text-sm ${m?"bg-red-900/30 border border-red-700 text-red-300":"bg-red-50 border border-red-200 text-red-700"}`,children:Ae}),y.jsx("button",{onClick:Oe,className:"w-full px-4 py-3 bg-[#2563eb] text-white rounded-lg hover:bg-[#1d4ed8] transition-colors",children:"Pokračovat"})]})})}),y.jsxs("div",{className:`absolute top-4 left-1/2 -translate-x-1/2 z-10 rounded-2xl shadow-lg max-w-2xl ${m?"bg-gray-900 border border-gray-800 text-[#c0caf5]":"bg-white border border-gray-200 text-gray-900"}`,style:{fontFamily:"var(--font-family, 'Fenomen Sans', sans-serif)",padding:"24px 40px"},children:[y.jsxs("div",{className:`text-base font-medium mb-3 ${m?"text-[#565f89]":"text-gray-400"}`,children:["Krok ",a+1," / ",se.length]}),y.jsx("div",{className:`text-lg font-medium ${m?"text-[#c0caf5]":"text-gray-800"}`,children:ce.description})]}),y.jsx(at,{currentStep:a,totalSteps:se.length,showCaptions:x,darkMode:m,scale:p,onStepChange:He,onRestart:tt,onToggleCaptions:()=>Xe(!x),onToggleDarkMode:()=>Te(!m),onZoomChange:e=>{const t=Math.max(.2,Math.min(.6,e)),n=b.width/2,s=b.height/2,o=(n-g.x)/p,i=(s-g.y)/p;J(t),M({x:n-o*t,y:s-i*t})}}),y.jsx(lt,{steps:se,currentStep:a,constructionTitle:"Interaktivní konstrukce trojúhelníku",darkMode:m,visible:X,onClose:()=>ne(!1)})]})}export{pt as InteractiveTriangleConstruction};

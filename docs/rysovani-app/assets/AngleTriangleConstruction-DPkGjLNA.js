import{r as m,j as b,A as ft}from"./index-DfOBZKLj.js";import{u as At,F as Pt}from"./slider-nTeksLnu.js";import{B as St}from"./BigNumberInput-3GaNQBQN.js";import{C as wt,a as vt}from"./ConstructionStepLog-DNERw8Hi.js";function jt({onBack:ve,darkMode:I,onDarkModeChange:Ze}){const _e=At(),L=m.useRef(null),x=m.useRef(null),ee=m.useRef(null),re=m.useRef(),[d,Ie]=m.useState(0),[A,ce]=m.useState(_e?.2:.4),[f,_]=m.useState({x:0,y:0}),[he,te]=m.useState(!1),[ne,be]=m.useState({x:0,y:0}),[k,Ke]=m.useState({width:1920,height:1080}),[O,ue]=m.useState(0),[ke,de]=m.useState(!0),[T,He]=m.useState(!0),[K,ge]=m.useState(!1),ye=[{notation:"AB",description:"Narýsuj základnu AB",type:"segment"},{notation:"∠α = ...°",description:"Zadej úhel α při vrcholu A",type:"angle"},{notation:"paprsek z A",description:"Narýsuj paprsek z bodu A pod úhlem α",type:"line"},{notation:"∠β = ...°",description:"Zadej úhel β při vrcholu B",type:"angle"},{notation:"paprsek z B",description:"Narýsuj paprsek z bodu B pod úhlem β",type:"line"},{notation:"C = paprsek z A ∩ paprsek z B",description:"Označ průsečík paprsků jako bod C",type:"point"},{notation:"AC, BC",description:"Dorýsuj strany AC a BC",type:"segment"},{notation:"ABC",description:"Opsat trojúhelník ABC",type:"segment"}],G=m.useRef(null),[Be,Ue]=m.useState(!1),[u,Te]=m.useState({x:860,y:900}),[g,Re]=m.useState({x:1460,y:900}),[i,V]=m.useState(null),[R,N]=m.useState(null),[se,oe]=m.useState(null),[je,Ge]=m.useState(!1),[Ve,Xe]=m.useState(!1),[Je,Qe]=m.useState(0),[Ce,et]=m.useState(1),[It,tt]=m.useState({x:0,y:0}),[v,me]=m.useState(null),[P,pe]=m.useState(null),[S,Me]=m.useState(null),[ze,D]=m.useState(""),[z,E]=m.useState(!0),[J,fe]=m.useState(null),[Ae,nt]=m.useState(null),Z=Math.sqrt(Math.pow(g.x-u.x,2)+Math.pow(g.y-u.y,2)),Ye=()=>{if(!P||!S||!v||P+S>=180)return null;const e=Math.atan2(g.y-u.y,g.x-u.x),t=P*Math.PI/180,o=S*Math.PI/180,s=e+t,n=e+Math.PI-o,a=Math.cos(s),r=Math.sin(s),c=Math.cos(n),p=Math.sin(n),h=g.x-u.x,l=g.y-u.y,y=a*-p-r*-c;if(Math.abs(y)<1e-4)return null;const M=(h*-p-l*-c)/y,w=u.x+M*a,B=u.y+M*r;return{x:w,y:B}},st=(e,t,o)=>{const s=Math.atan2(t.y-e.y,t.x-e.x);let a=Math.atan2(o.y-e.y,o.x-e.x)-s;for(;a<0;)a+=2*Math.PI;for(;a>2*Math.PI;)a-=2*Math.PI;a>Math.PI&&(a=2*Math.PI-a);const r=Math.round(a*180/Math.PI),c=Math.atan2(o.y-t.y,o.x-t.x);let h=s+Math.PI-c;for(;h<0;)h+=2*Math.PI;for(;h>2*Math.PI;)h-=2*Math.PI;h>Math.PI&&(h=2*Math.PI-h);const l=Math.round(h*180/Math.PI);return{alpha:r,beta:l}};m.useEffect(()=>{v&&!J&&Z>0&&(fe(Z),nt(v))},[v,J,Z]),m.useEffect(()=>{if(J&&Ae&&(R==="A"||R==="B")){const e=Ae/J,t=Math.round(Z*e*10)/10;me(t)}},[Z,R,J,Ae]),m.useEffect(()=>{if(!i&&d>=5&&P&&S&&v){const e=Ye();e&&V(e)}},[d,P,S,u,g,v,i]),m.useEffect(()=>{if(i&&R!=="C"&&(R==="A"||R==="B")&&P&&S&&v){const e=Ye();e&&V(e)}},[u,g,R,P,S,v,i]),m.useEffect(()=>{if(i&&R==="C"){const e=st(u,g,i);e.alpha>0&&e.alpha<180&&e.beta>0&&e.beta<180&&(pe(e.alpha),Me(e.beta))}},[i,u,g,R]),m.useEffect(()=>{x.current||(x.current=document.createElement("canvas"))},[]),m.useEffect(()=>{const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{G.current=e,Ue(!0)},e.onerror=()=>console.error("Failed to load ruler image"),e.src="https://jjpiguuubvmiobmixwgh.supabase.co/storage/v1/object/public/Admin%20math/pravitko4.svg"},[]);const ae=(e,t)=>({x:(e-f.x)/A,y:(t-f.y)/A}),W=(e,t,o=15)=>{const s=e.x-t.x,n=e.y-t.y;return Math.sqrt(s*s+n*n)<o},$=(e,t,o)=>{const s=e.x*A+f.x,n=e.y*A+f.y,a=s+o.x,r=n+o.y,c=20,p=t.x-a,h=t.y-(r-8);return Math.sqrt(p*p+h*h)<c},xe=()=>{if(!k.width||!k.height)return;const e=(u.x+g.x)/2,t=u.y,o=k.width/2,s=k.height/2;_({x:o-e*A,y:s-t*A})};m.useEffect(()=>{const e=()=>{ee.current&&Ke({width:ee.current.clientWidth,height:ee.current.clientHeight})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),m.useEffect(()=>{k.width>0&&k.height>0&&(xe(),je||Ge(!0))},[k.width,k.height,je]),m.useEffect(()=>{const e=L.current,t=x.current;if(!e||!t)return;const o=window.devicePixelRatio||1;e.width=k.width*o,e.height=k.height*o,t.width=k.width*o,t.height=k.height*o},[k]),m.useEffect(()=>(ke&&O<1&&!z?re.current=requestAnimationFrame(()=>{ue(e=>Math.min(e+.009,1))}):O>=1&&de(!1),()=>{re.current&&cancelAnimationFrame(re.current)}),[ke,O,z]);const ot=()=>{if(D(""),d===0){if(v===null||v<0){D("Zadej prosím platnou délku (0-99 cm)");return}if(v===0){D("Délka základny musí být větší než 0 cm");return}fe(null),E(!1)}else if(d===1){if(!P||P<=0){D("Zadej prosím úhel větší než 0°");return}if(P>=180){D("Úhel musí být menší než 180°");return}E(!1)}else if(d===3){if(!S||S<=0){D("Zadej prosím úhel větší než 0°");return}if(S>=180){D("Úhel musí být menší než 180°");return}if(P&&S+P>=180){D(`Součet úhlů musí být menší než 180°. (${P}° + ${S}° = ${P+S}°)`);return}E(!1)}},at=e=>{let t=50*A;for(;t<35;)t*=2;e.strokeStyle=I?"rgba(125, 107, 194, 0.15)":"rgba(229, 231, 235, 0.8)",e.lineWidth=1;const o=f.x%t,s=f.y%t;for(let n=o;n<=k.width;n+=t)e.beginPath(),e.moveTo(n,0),e.lineTo(n,k.height),e.stroke();for(let n=s;n<=k.height;n+=t)e.beginPath(),e.moveTo(0,n),e.lineTo(k.width,n),e.stroke()},ie=(e,t,o,s="#000",n=12,a=-12,r=1)=>{e.save(),e.setTransform(r,0,0,r,0,0);const c=t.x*A+f.x,p=t.y*A+f.y;e.font="bold 16px Inter, system-ui, sans-serif";const l=e.measureText(o).width,y=8,M=c+n+l/2,w=p+a-8,B=Math.max(l,16)/2+y;e.fillStyle="#3b82f6",e.beginPath(),e.arc(M,w,B,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff",e.textAlign="center",e.textBaseline="middle",e.fillText(o,M,w),e.restore()},De=(e,t,o,s="#000",n=!1)=>{const a=n?24:20,r=o+Math.PI/2,c={x:t.x+Math.cos(r)*a/2,y:t.y+Math.sin(r)*a/2},p={x:t.x-Math.cos(r)*a/2,y:t.y-Math.sin(r)*a/2};e.strokeStyle=s,e.lineWidth=6,e.lineCap="butt",e.beginPath(),e.moveTo(c.x,c.y),e.lineTo(p.x,p.y),e.stroke(),n&&(e.fillStyle=I?"rgba(96, 165, 250, 0.25)":"rgba(59, 130, 246, 0.15)",e.beginPath(),e.arc(t.x,t.y,18,0,Math.PI*2),e.fill())},We=(e,t,o,s="#000")=>{e.fillStyle=I?"rgba(75, 85, 99, 0.4)":"rgba(200, 200, 200, 0.3)",e.beginPath(),e.arc(t.x,t.y,10,0,Math.PI*2),e.fill(),e.fillStyle=s,e.beginPath(),e.arc(t.x,t.y,7,0,Math.PI*2),e.fill(),e.strokeStyle=I?"#111827":"#ffffff",e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,7,0,Math.PI*2),e.stroke()},H=(e,t,o,s,n=1)=>{const a=(t.x+o.x)/2,r=(t.y+o.y)/2,c=o.x-t.x,p=o.y-t.y,h=Math.atan2(p,c);e.save(),e.setTransform(n,0,0,n,0,0);const l=a*A+f.x,y=r*A+f.y;e.translate(l,y),e.rotate(h);const M=`${s}cm`;e.font='600 18px "Fenomen Sans", Arial, sans-serif',e.fillStyle=I?"#e5e7eb":"#1f2937",e.textAlign="center",e.textBaseline="bottom",e.fillText(M,0,-8),e.restore()},Q=(e,t,o,s,n=120,a="#fbbf24")=>{const r=o>s;e.strokeStyle="rgba(251, 191, 36, 0.3)",e.lineWidth=16,e.beginPath(),e.arc(t.x,t.y,n,o,s,r),e.stroke(),e.strokeStyle=a,e.lineWidth=6,e.beginPath(),e.arc(t.x,t.y,n,o,s,r),e.stroke();const c=(o+s)/2,p=t.x+Math.cos(c)*n*.5,h=t.y+Math.sin(c)*n*.5;e.fillStyle=a,e.beginPath(),e.arc(p,h,6,0,Math.PI*2),e.fill()},le=(e,t,o,s="#000",n=2,a=1)=>{let r=0;a<=.15?r=0:a>=.85?r=1:r=(a-.15)/.7;const c={x:t.x+(o.x-t.x)*r,y:t.y+(o.y-t.y)*r},p=r<1;p&&r>0&&(e.strokeStyle="rgba(251, 191, 36, 0.5)",e.lineWidth=n*10,e.lineCap="round",e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(c.x,c.y),e.stroke()),r>0&&(e.strokeStyle=s,e.lineWidth=p?n*1.5:n,e.lineCap="round",e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(c.x,c.y),e.stroke())},$e=(e,t,o,s,n="#93c5fd",a=4,r=1)=>{let c=0;r<=.15?c=0:r>=.85?c=1:c=(r-.15)/.7;const p={x:t.x+Math.cos(o)*s*c,y:t.y+Math.sin(o)*s*c},h=c<1;h&&c>0&&(e.strokeStyle="rgba(251, 191, 36, 0.5)",e.lineWidth=a*10,e.lineCap="round",e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(p.x,p.y),e.stroke()),c>0&&(e.strokeStyle=n,e.lineWidth=h?a*1.5:a,e.lineCap="round",e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(p.x,p.y),e.stroke())},Le=(e,t,o,s=200,n="#f97316",a=1)=>{e.strokeStyle=n,e.lineWidth=8,e.beginPath(),e.arc(t.x,t.y,s,0,Math.PI*2),e.stroke(),e.strokeStyle=`${n}60`,e.lineWidth=3,e.beginPath(),e.arc(t.x,t.y,s+15,0,Math.PI*2),e.stroke();for(let r=0;r<360;r+=10){const c=r*Math.PI/180,p=r%30===0,l=s-(p?20:10),y=t.x+Math.cos(c)*l,M=t.y+Math.sin(c)*l,w=t.x+Math.cos(c)*s,B=t.y+Math.sin(c)*s;if(e.strokeStyle=n,e.lineWidth=p?3:2,e.beginPath(),e.moveTo(y,M),e.lineTo(w,B),e.stroke(),p){const j=s+35,X=t.x+Math.cos(c)*j,Y=t.y+Math.sin(c)*j;e.save(),e.setTransform(a,0,0,a,0,0);const F=X*A+f.x,q=Y*A+f.y;e.font='400 12px "Fenomen Sans", Arial, sans-serif',e.fillStyle=n,e.textAlign="center",e.textBaseline="middle",e.fillText(`${r}°`,F,q),e.restore()}}},C=(e,t,o,s,n=120,a="#fbbf24",r=!1)=>{const c=o>s;if(e.strokeStyle="rgba(251, 191, 36, 0.3)",e.lineWidth=16,e.beginPath(),e.arc(t.x,t.y,n,o,s,c),e.stroke(),e.strokeStyle=a,e.lineWidth=6,e.beginPath(),e.arc(t.x,t.y,n,o,s,c),e.stroke(),r){const h=s,l={x:t.x+Math.cos(h)*n,y:t.y+Math.sin(h)*n},y=c?-1:1;e.fillStyle="rgba(0, 0, 0, 0.2)",e.beginPath(),e.moveTo(l.x+2,l.y+2),e.lineTo(l.x+2+y*24*Math.cos(h-Math.PI/6),l.y+2+y*24*Math.sin(h-Math.PI/6)),e.lineTo(l.x+2+y*24*Math.cos(h+Math.PI/6),l.y+2+y*24*Math.sin(h+Math.PI/6)),e.closePath(),e.fill(),e.fillStyle=a,e.beginPath(),e.moveTo(l.x,l.y),e.lineTo(l.x+y*24*Math.cos(h-Math.PI/6),l.y+y*24*Math.sin(h-Math.PI/6)),e.lineTo(l.x+y*24*Math.cos(h+Math.PI/6),l.y+y*24*Math.sin(h+Math.PI/6)),e.closePath(),e.fill(),e.strokeStyle=a,e.lineWidth=2,e.stroke()}},Pe=(e,t,o,s)=>{if(!T||!Be||!G.current)return;let n=0;if(s<.15)n=s/.15;else if(s>=.15&&s<=.85)n=1;else if(s>.85&&s<1)n=(1-s)/.15;else return;const a=G.current,r=800,c=400;e.save();const p=o.x-t.x,h=o.y-t.y,l=Math.sqrt(p*p+h*h),y=Math.atan2(h,p);e.translate(t.x,t.y),e.rotate(y),e.globalAlpha=n;const M=l/2-r/2;e.drawImage(a,M,-c,r,c),e.restore()},Ne=(e,t,o,s)=>{if(!T||!Be||!G.current)return;let n=0;if(s<.15)n=s/.15;else if(s>=.15&&s<=.85)n=1;else if(s>.85&&s<1)n=(1-s)/.15;else return;const a=G.current,r=800,c=400;e.save(),e.translate(t.x,t.y),e.rotate(o),e.globalAlpha=n,e.drawImage(a,200,-c,r,c),e.restore()},Se=(()=>{switch(d){case 0:return{title:"Narýsuj základnu AB",description:z?"Kolik centimetrů má mít základna AB?":`Rýsujeme základnu AB = ${v} cm. Body A a B můžeš přesouvat myší!`,needsInput:z,inputLabel:"Délka základny AB (cm)"};case 1:return{title:"Zadej úhel α při vrcholu A",description:z?"Kolik stupňů má mít úhel α (alfa) při vrcholu A?":`Úhel α při vrcholu A = ${P}°`,needsInput:z,inputLabel:"Úhel α (stupně)"};case 2:return{title:"Narýsuj paprsek z bodu A",description:`Rýsujeme paprsek z bodu A pod úhlem ${P}°`,needsInput:!1};case 3:return{title:"Zadej úhel β při vrcholu B",description:z?"Kolik stupňů má mít úhel β (beta) při vrcholu B?":`Úhel β při vrcholu B = ${S}°`,needsInput:z,inputLabel:"Úhel β (stupně)"};case 4:return{title:"Narýsuj paprsek z bodu B",description:`Rýsujeme paprsek z bodu B pod úhlem ${S}°`,needsInput:!1};case 5:return i?{title:"Označ průsečík jako bod C",description:"Bod, ve kterém se paprsky protly, pojmenujeme C. To je třetí vrchol trojúhelníku.",needsInput:!1}:{title:"Paprsky se neprotly! ❌",description:`Úhly ${P}° a ${S}° netvoří trojúhelník. Součet musí být menší než 180°.`,needsInput:!1,error:!0};case 6:return{title:"Dorýsuj trojúhelník",description:"Spojíme body A-C a B-C. Trojúhelník ABC je hotový!",needsInput:!1};case 7:return{title:"Opsat trojúhelník",description:"Připíšeme délky stran a velikost úhlu C.",needsInput:!1};default:return{title:"",description:"",needsInput:!1}}})(),it=(e,t)=>{const o=window.devicePixelRatio||1;if(!x.current||x.current.width===0||x.current.height===0)return;e.clearRect(0,0,x.current.width,x.current.height),e.save(),e.scale(o,o),at(e),e.translate(f.x,f.y),e.scale(A,A);const s=window.devicePixelRatio||1,n=Math.atan2(g.y-u.y,g.x-u.x),a=I?"#e5e7eb":"#1f2937",r=I?"#93c5fd":"#3b82f6",c=I?"#fca5a5":"#ef4444",p=I?"#6ee7b7":"#10b981",h=I?"#fbbf24":"#f59e0b";if(d>=0&&v&&(le(e,u,g,a,6,d===0&&!z?t:1),d===0&&!z&&T&&Pe(e,u,g,t),(d>0||d===0&&!z&&t>.85)&&T&&H(e,u,g,v,s)),d>=1&&P&&!z){const l=P*Math.PI/180;if(d===1){if(t>.05){const M=Math.min((t-.05)/.15,1);e.globalAlpha=M,Le(e,u,n,200,"#f97316",s),e.globalAlpha=1}const y=t;if(y>.2){const M=n+l*((y-.2)/.8);if((P===90||P===270)&&y>.8?Q(e,u,n,M,120,h):C(e,u,n,M,120,h,!0),y>.5){const B=(M-n)*180/Math.PI,j=160,X=n+(M-n)/2,Y=u.x+Math.cos(X)*j,F=u.y+Math.sin(X)*j;e.save(),e.setTransform(s,0,0,s,0,0);const q=Y*A+f.x,U=F*A+f.y;e.font='600 20px "Fenomen Sans", Arial, sans-serif',e.fillStyle=h,e.textAlign="center",e.textBaseline="middle",e.fillText(`${Math.round(B)}°`,q,U),e.restore()}}}else if(d>=2&&(P===90||P===270?Q(e,u,n,n+l,120,h):C(e,u,n,n+l,120,h,!1),T)){const w=n+l/2,B=u.x+Math.cos(w)*160,j=u.y+Math.sin(w)*160;e.save(),e.setTransform(s,0,0,s,0,0);const X=B*A+f.x,Y=j*A+f.y;e.font='600 20px "Fenomen Sans", Arial, sans-serif',e.fillStyle=h,e.textAlign="center",e.textBaseline="middle",e.fillText(`${P}°`,X,Y),e.restore()}}if(d>=2&&P){const l=P*Math.PI/180,y=n+l;$e(e,u,y,2400,r,4,d===2?t:1),d===2&&T&&Ne(e,u,y,t)}if(d>=3&&S&&!z){const l=S*Math.PI/180,y=n+Math.PI-l;if(d===3){if(t>.05){const w=Math.min((t-.05)/.15,1);e.globalAlpha=w,Le(e,g,n+Math.PI,200,"#f97316",s),e.globalAlpha=1}const M=t;if(M>.2){const w=n+Math.PI-l*((M-.2)/.8);if((S===90||S===270)&&M>.8?Q(e,g,n+Math.PI,w,120,h):C(e,g,n+Math.PI,w,120,h,!0),M>.5){const j=(n+Math.PI-w)*180/Math.PI,X=160,Y=n+Math.PI-(n+Math.PI-w)/2,F=g.x+Math.cos(Y)*X,q=g.y+Math.sin(Y)*X;e.save(),e.setTransform(s,0,0,s,0,0);const U=F*A+f.x,we=q*A+f.y;e.font='600 20px "Fenomen Sans", Arial, sans-serif',e.fillStyle=h,e.textAlign="center",e.textBaseline="middle",e.fillText(`${Math.round(j)}°`,U,we),e.restore()}}}else if(d>=4&&(S===90||S===270?Q(e,g,n+Math.PI,y,120,h):C(e,g,n+Math.PI,y,120,h,!1),T)){const B=n+Math.PI-l/2,j=g.x+Math.cos(B)*160,X=g.y+Math.sin(B)*160;e.save(),e.setTransform(s,0,0,s,0,0);const Y=j*A+f.x,F=X*A+f.y;e.font='600 20px "Fenomen Sans", Arial, sans-serif',e.fillStyle=h,e.textAlign="center",e.textBaseline="middle",e.fillText(`${S}°`,Y,F),e.restore()}}if(d>=4&&S){const l=S*Math.PI/180,y=n+Math.PI-l;$e(e,g,y,2400,r,4,d===4?t:1),d===4&&T&&Ne(e,g,y,t)}if(d>=5&&i&&d===5&&t>.1){const l=Math.min((t-.1)/.3,1);if(l<1){const y=25+l*35;e.strokeStyle=`rgba(251, 191, 36, ${.7*(1-l)})`,e.lineWidth=6,e.beginPath(),e.arc(i.x,i.y,y,0,Math.PI*2),e.stroke();const M=15+l*20;e.strokeStyle=`rgba(251, 191, 36, ${.5*(1-l)})`,e.lineWidth=4,e.beginPath(),e.arc(i.x,i.y,M,0,Math.PI*2),e.stroke()}if(l>.3){const y=Math.min((l-.3)/.4,1),M=25*y;e.strokeStyle=h,e.lineWidth=4,e.globalAlpha=y,e.beginPath(),e.moveTo(i.x-M,i.y),e.lineTo(i.x+M,i.y),e.stroke(),e.beginPath(),e.moveTo(i.x,i.y-M),e.lineTo(i.x,i.y+M),e.stroke(),e.globalAlpha=1}}if(d>=6&&i&&v){const l=t*2;if(l<=1?(le(e,u,i,p,5,l),T&&Pe(e,u,i,l)):(le(e,u,i,p,5,1),le(e,g,i,p,5,l-1),T&&Pe(e,g,i,l-1)),(d>6||d===6&&t>.85)&&T){const y=Math.sqrt(Math.pow(i.x-u.x,2)+Math.pow(i.y-u.y,2)),M=Math.sqrt(Math.pow(i.x-g.x,2)+Math.pow(i.y-g.y,2)),w=Math.sqrt(Math.pow(g.x-u.x,2)+Math.pow(g.y-u.y,2)),B=Math.round(y/w*v*10)/10,j=Math.round(M/w*v*10)/10;H(e,u,i,B,s),H(e,g,i,j,s)}}if(d>=7&&i&&v&&P&&S){const l=Math.sqrt(Math.pow(i.x-u.x,2)+Math.pow(i.y-u.y,2)),y=Math.sqrt(Math.pow(i.x-g.x,2)+Math.pow(i.y-g.y,2)),M=Math.round(l/Z*v*10)/10,w=Math.round(y/Z*v*10)/10,B=180-P-S;if(T&&(e.globalAlpha=Math.min(t/.3,1),H(e,u,g,v,s),t>.3&&(e.globalAlpha=Math.min((t-.3)/.3,1),H(e,u,i,M,s)),t>.6&&(e.globalAlpha=Math.min((t-.6)/.3,1),H(e,g,i,w,s)),e.globalAlpha=1,t>.8)){const j=Math.min((t-.8)/.2,1);e.globalAlpha=j;const X=Math.atan2(u.y-i.y,u.x-i.x),Y=Math.atan2(g.y-i.y,g.x-i.x);B===90||B===270?Q(e,i,X,Y,80,h):C(e,i,X,Y,80,h,!1);const q=120,U=(X+Y)/2,we=i.x+Math.cos(U)*q,mt=i.y+Math.sin(U)*q;e.save(),e.setTransform(s,0,0,s,0,0);const pt=we*A+f.x,Mt=mt*A+f.y;e.font='600 20px "Fenomen Sans", Arial, sans-serif',e.fillStyle=h,e.textAlign="center",e.textBaseline="middle",e.fillText(`${B}°`,pt,Mt),e.restore(),e.globalAlpha=1}}if(d>=0&&v&&(T&&(De(e,u,n,a,se==="A"),De(e,g,n,a,se==="B")),ie(e,u,"A",a,-25,-12,s),ie(e,g,"B",a,12,-12,s)),d>=5&&i)if(d===5){if(t>.5){const l=Math.min((t-.5)/.3,1);e.globalAlpha=l,We(e,i,"C",c),e.globalAlpha=1,l>.4&&ie(e,i,"C",c,12,-12,s)}}else We(e,i,"C",c),ie(e,i,"C",c,12,-12,s);e.restore()};m.useEffect(()=>{const e=L.current,t=x.current;if(!e||!t||e.width===0||e.height===0||t.width===0||t.height===0)return;const o=e.getContext("2d"),s=t.getContext("2d");if(!o||!s)return;it(s,O),o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,e.width,e.height);const n=O<.05?O/.05:1;o.globalAlpha=n,o.drawImage(t,0,0),o.globalAlpha=1},[d,A,f,k,u,g,i,se,O,T,I,v,P,S,z]);const lt=e=>{e>d&&(d===0&&!v||d===1&&!P||d===3&&!S||d===5&&!i)||(Ie(e),ue(0),de(!0),E(e===0&&!v||e===1&&!P?!0:e===3&&!S))},rt=e=>{const t=L.current?.getBoundingClientRect();if(!t)return;const o=e.clientX-t.left,s=e.clientY-t.top,n=ae(o,s),a={x:o,y:s};if(W(u,n)||$(u,a,{x:-25,y:-12})){N("A");return}if(W(g,n)||$(g,a,{x:12,y:-12})){N("B");return}if(i&&d>=5&&(W(i,n)||$(i,a,{x:12,y:-12}))){N("C");return}te(!0),be({x:e.clientX-f.x,y:e.clientY-f.y})},ct=e=>{const t=L.current?.getBoundingClientRect();if(!t)return;const o=e.clientX-t.left,s=e.clientY-t.top,n=ae(o,s),a={x:o,y:s};if(R==="A"){Te(n);return}if(R==="B"){Re(n);return}if(R==="C"){V(n);return}if(he){_({x:e.clientX-ne.x,y:e.clientY-ne.y});return}W(u,n)||$(u,a,{x:-25,y:-12})?oe("A"):W(g,n)||$(g,a,{x:12,y:-12})?oe("B"):i&&d>=5&&(W(i,n)||$(i,a,{x:12,y:-12}))?oe("C"):oe(null)},Ee=()=>{te(!1),N(null)},Fe=(e,t)=>{const o=e.clientX-t.clientX,s=e.clientY-t.clientY;return Math.sqrt(o*o+s*s)},qe=(e,t)=>({x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2}),ht=e=>{const t=L.current?.getBoundingClientRect();if(!t)return;if(e.touches.length===2){const c=Fe(e.touches[0],e.touches[1]),p=qe(e.touches[0],e.touches[1]);Xe(!0),Qe(c),et(A),tt(p),e.preventDefault();return}if(e.touches.length!==1)return;const o=e.touches[0],s=o.clientX-t.left,n=o.clientY-t.top,a=ae(s,n),r={x:s,y:n};if(W(u,a)||$(u,r,{x:-25,y:-12})){N("A"),e.preventDefault();return}if(W(g,a)||$(g,r,{x:12,y:-12})){N("B"),e.preventDefault();return}if(i&&d>=5&&(W(i,a)||$(i,r,{x:12,y:-12}))){N("C"),e.preventDefault();return}te(!0),be({x:o.clientX-f.x,y:o.clientY-f.y}),e.preventDefault()},ut=e=>{const t=L.current?.getBoundingClientRect();if(!t)return;if(e.touches.length===2&&Ve){const r=Fe(e.touches[0],e.touches[1]),c=qe(e.touches[0],e.touches[1]),p=r/Je,h=Math.max(.2,Math.min(.6,Ce*p)),l=c.x-t.left,y=c.y-t.top,M=h/A,w={x:l-(l-f.x)*M,y:y-(y-f.y)*M};ce(h),_(w),e.preventDefault();return}if(e.touches.length!==1)return;const o=e.touches[0],s=o.clientX-t.left,n=o.clientY-t.top,a=ae(s,n);if(R==="A"){Te(a),e.preventDefault();return}if(R==="B"){Re(a),e.preventDefault();return}if(R==="C"){V(a),e.preventDefault();return}if(he){_({x:o.clientX-ne.x,y:o.clientY-ne.y}),e.preventDefault();return}},Oe=()=>{te(!1),N(null),Xe(!1)},dt=e=>{e.preventDefault();const t=e.deltaY>0?.9:1.1,o=Math.max(.2,Math.min(.6,A*t)),s=L.current?.getBoundingClientRect();if(!s)return;const n=s.width/2,a=s.height/2,r=o/A;_({x:n-(n-f.x)*r,y:a-(a-f.y)*r}),ce(o)},gt=()=>R?"grabbing":se?"move":he?"grabbing":"grab",yt=()=>{Ie(0),me(null),pe(null),Me(null),V(null),fe(null),D(""),E(!0),ue(0),de(!0),xe()};return b.jsxs("div",{className:"size-full flex flex-col relative",children:[b.jsx("div",{ref:ee,className:`flex-1 ${I?"bg-[#1a1b26]":"bg-white"}`,children:b.jsx("canvas",{ref:L,className:"w-full h-full",style:{cursor:gt(),touchAction:"none"},onMouseDown:rt,onMouseMove:ct,onMouseUp:Ee,onMouseLeave:Ee,onTouchStart:ht,onTouchMove:ut,onTouchEnd:Oe,onTouchCancel:Oe,onWheel:dt})}),b.jsxs("button",{onClick:ve,onTouchEnd:e=>{e.preventDefault(),ve()},className:`absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-2 rounded-xl shadow-[0_2px_12px_rgba(0,0,0,0.08)] transition-all ${I?"bg-[#1a1b26]/90 hover:bg-[#24283b] text-[#c0caf5] border border-[#2a2b3d] backdrop-blur-sm":"bg-white/90 hover:bg-gray-50 border border-gray-200/60 backdrop-blur-sm"}`,children:[b.jsx(ft,{className:"size-5"}),b.jsx("span",{className:"text-sm font-medium",children:"Menu"})]}),b.jsx("div",{className:`absolute top-4 z-10 transition-all duration-300 ${K?"right-[576px]":"right-4"}`,children:b.jsxs("button",{onClick:()=>ge(!K),onTouchEnd:e=>{e.preventDefault(),ge(!K)},className:`p-3 rounded-xl transition-all relative group/protocol ${K?I?"bg-[#7aa2f7] text-white":"bg-[#1e1b4b] text-white":I?"bg-[#24283b] hover:bg-[#414868] text-[#c0caf5]":"bg-white/90 hover:bg-gray-50 text-gray-700 shadow-[0_2px_12px_rgba(0,0,0,0.08)] border border-gray-200/60 backdrop-blur-sm"}`,title:"Zápis konstrukce",children:[b.jsx(Pt,{className:"size-5"}),!K&&b.jsx("div",{className:"absolute right-0 top-full mt-2 px-3 py-1.5 bg-black/80 text-white text-xs rounded-lg whitespace-nowrap opacity-0 group-hover/protocol:opacity-100 transition-opacity pointer-events-none",children:"Zápis konstrukce"})]})}),Se.needsInput&&b.jsx("div",{className:"absolute inset-0 z-20 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:b.jsxs("div",{className:`w-full max-w-2xl rounded-2xl border-2 p-8 ${I?"bg-[#1f2937] border-gray-600":"bg-white border-gray-200"}`,children:[b.jsx("div",{className:"mb-8",children:b.jsx(St,{value:d===0?v:d===1?P:d===3?S:null,onChange:e=>{d===0?me(e):d===1?pe(e):d===3&&Me(e)},min:0,max:d===0?99:179,step:1,unit:d===0?"cm":"°",darkMode:I,label:Se.title})}),ze&&b.jsx("div",{className:`p-4 rounded-lg mb-6 ${I?"bg-red-900/30 border border-red-700 text-red-300":"bg-red-50 border border-red-200 text-red-700"}`,children:ze}),b.jsx("button",{onClick:ot,className:"w-full px-6 py-4 bg-[#2563eb] text-white rounded-xl hover:bg-[#1d4ed8] transition-colors text-lg",children:"Pokračovat"})]})}),b.jsxs("div",{className:`absolute top-4 left-1/2 -translate-x-1/2 z-10 rounded-2xl shadow-lg max-w-2xl ${I?"bg-gray-900 border border-gray-800 text-[#c0caf5]":"bg-white border border-gray-200 text-gray-900"}`,style:{fontFamily:"var(--font-family, 'Fenomen Sans', sans-serif)",padding:"24px 40px"},children:[b.jsxs("div",{className:`text-base font-medium mb-3 ${I?"text-[#565f89]":"text-gray-400"}`,children:["Krok ",d+1," / ",ye.length]}),b.jsx("div",{className:`text-lg font-medium ${I?"text-[#c0caf5]":"text-gray-800"}`,children:Se.description})]}),b.jsx(wt,{currentStep:d,totalSteps:ye.length,showCaptions:T,darkMode:I,scale:A,onStepChange:lt,onRestart:yt,onToggleCaptions:()=>He(!T),onToggleDarkMode:()=>Ze(!I),onZoomChange:e=>{const t=Math.max(.2,Math.min(.6,e)),o=k.width/2,s=k.height/2,n=(o-f.x)/A,a=(s-f.y)/A;ce(t),_({x:o-n*t,y:s-a*t})}}),b.jsx(vt,{steps:ye,currentStep:d,constructionTitle:"Konstrukce trojúhelníku (SUS)",darkMode:I,visible:K,onClose:()=>ge(!1)})]})}export{jt as AngleTriangleConstruction};

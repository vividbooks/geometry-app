import{r as m,j as b,A as Mt}from"./index-BgMRNiBW.js";import{u as At,F as Pt}from"./slider-BC5w80oe.js";import{B as St}from"./BigNumberInput-CrpcjfEy.js";import{C as wt,a as vt}from"./ConstructionStepLog-CvMg6uy3.js";function jt({onBack:ve,darkMode:I,onDarkModeChange:Ze}){const _e=At(),L=m.useRef(null),D=m.useRef(null),te=m.useRef(null),ce=m.useRef(),[l,Ie]=m.useState(0),[A,he]=m.useState(_e?.2:.4),[M,K]=m.useState({x:0,y:0}),[ue,ne]=m.useState(!1),[se,be]=m.useState({x:0,y:0}),[k,Ke]=m.useState({width:1920,height:1080}),[Z,de]=m.useState(0),[ke,ge]=m.useState(!0),[T,He]=m.useState(!0),[H,ye]=m.useState(!1),Y=[{notation:"AB",description:"Narýsuj základnu AB",type:"segment"},{notation:"∠α = ...°",description:"Zadej úhel α při vrcholu A",type:"angle"},{notation:"paprsek z A",description:"Narýsuj paprsek z bodu A pod úhlem α",type:"line"},{notation:"∠β = ...°",description:"Zadej úhel β při vrcholu B",type:"angle"},{notation:"paprsek z B",description:"Narýsuj paprsek z bodu B pod úhlem β",type:"line"},{notation:"C = paprsek z A ∩ paprsek z B",description:"Označ průsečík paprsků jako bod C",type:"point"},{notation:"AC, BC",description:"Dorýsuj strany AC a BC",type:"segment"},{notation:"ABC",description:"Opsat trojúhelník ABC",type:"segment"}],V=m.useRef(null),[Be,Ue]=m.useState(!1),[d,Te]=m.useState({x:860,y:900}),[g,Re]=m.useState({x:1460,y:900}),[i,J]=m.useState(null),[R,E]=m.useState(null),[oe,ae]=m.useState(null),[je,Ge]=m.useState(!1),[Ve,xe]=m.useState(!1),[Je,Qe]=m.useState(0),[Ce,et]=m.useState(1),[It,tt]=m.useState({x:0,y:0}),[v,me]=m.useState(null),[P,pe]=m.useState(null),[S,fe]=m.useState(null),[Xe,N]=m.useState(""),[X,F]=m.useState(!0),[Q,Me]=m.useState(null),[Ae,nt]=m.useState(null),_=Math.sqrt(Math.pow(g.x-d.x,2)+Math.pow(g.y-d.y,2)),ze=()=>{if(!P||!S||!v||P+S>=180)return null;const e=Math.atan2(g.y-d.y,g.x-d.x),t=P*Math.PI/180,o=S*Math.PI/180,s=e+t,n=e+Math.PI-o,a=Math.cos(s),c=Math.sin(s),h=Math.cos(n),p=Math.sin(n),u=g.x-d.x,r=g.y-d.y,y=a*-p-c*-h;if(Math.abs(y)<1e-4)return null;const f=(u*-p-r*-h)/y,w=d.x+f*a,B=d.y+f*c;return{x:w,y:B}},st=(e,t,o)=>{const s=Math.atan2(t.y-e.y,t.x-e.x);let a=Math.atan2(o.y-e.y,o.x-e.x)-s;for(;a<0;)a+=2*Math.PI;for(;a>2*Math.PI;)a-=2*Math.PI;a>Math.PI&&(a=2*Math.PI-a);const c=Math.round(a*180/Math.PI),h=Math.atan2(o.y-t.y,o.x-t.x);let u=s+Math.PI-h;for(;u<0;)u+=2*Math.PI;for(;u>2*Math.PI;)u-=2*Math.PI;u>Math.PI&&(u=2*Math.PI-u);const r=Math.round(u*180/Math.PI);return{alpha:c,beta:r}};m.useEffect(()=>{v&&!Q&&_>0&&(Me(_),nt(v))},[v,Q,_]),m.useEffect(()=>{if(Q&&Ae&&(R==="A"||R==="B")){const e=Ae/Q,t=Math.round(_*e*10)/10;me(t)}},[_,R,Q,Ae]),m.useEffect(()=>{if(!i&&l>=5&&P&&S&&v){const e=ze();e&&J(e)}},[l,P,S,d,g,v,i]),m.useEffect(()=>{if(i&&R!=="C"&&(R==="A"||R==="B")&&P&&S&&v){const e=ze();e&&J(e)}},[d,g,R,P,S,v,i]),m.useEffect(()=>{if(i&&R==="C"){const e=st(d,g,i);e.alpha>0&&e.alpha<180&&e.beta>0&&e.beta<180&&(pe(e.alpha),fe(e.beta))}},[i,d,g,R]),m.useEffect(()=>{D.current||(D.current=document.createElement("canvas"))},[]),m.useEffect(()=>{const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{V.current=e,Ue(!0)},e.onerror=()=>console.error("Failed to load ruler image"),e.src="https://jjpiguuubvmiobmixwgh.supabase.co/storage/v1/object/public/Admin%20math/pravitko4.svg"},[]);const ie=(e,t)=>({x:(e-M.x)/A,y:(t-M.y)/A}),W=(e,t,o=15)=>{const s=e.x-t.x,n=e.y-t.y;return Math.sqrt(s*s+n*n)<o},$=(e,t,o)=>{const s=e.x*A+M.x,n=e.y*A+M.y,a=s+o.x,c=n+o.y,h=20,p=t.x-a,u=t.y-(c-8);return Math.sqrt(p*p+u*u)<h},Ye=()=>{if(!k.width||!k.height)return;const e=(d.x+g.x)/2,t=d.y,o=k.width/2,s=k.height/2;K({x:o-e*A,y:s-t*A})};m.useEffect(()=>{const e=()=>{te.current&&Ke({width:te.current.clientWidth,height:te.current.clientHeight})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),m.useEffect(()=>{k.width>0&&k.height>0&&(Ye(),je||Ge(!0))},[k.width,k.height,je]),m.useEffect(()=>{const e=L.current,t=D.current;if(!e||!t)return;const o=window.devicePixelRatio||1;e.width=k.width*o,e.height=k.height*o,t.width=k.width*o,t.height=k.height*o},[k]),m.useEffect(()=>(ke&&Z<1&&!X?ce.current=requestAnimationFrame(()=>{de(e=>Math.min(e+.009,1))}):Z>=1&&ge(!1),()=>{ce.current&&cancelAnimationFrame(ce.current)}),[ke,Z,X]);const ot=()=>{if(N(""),l===0){if(v===null||v<0){N("Zadej prosím platnou délku (0-99 cm)");return}if(v===0){N("Délka základny musí být větší než 0 cm");return}Me(null),F(!1)}else if(l===1){if(!P||P<=0){N("Zadej prosím úhel větší než 0°");return}if(P>=180){N("Úhel musí být menší než 180°");return}F(!1)}else if(l===3){if(!S||S<=0){N("Zadej prosím úhel větší než 0°");return}if(S>=180){N("Úhel musí být menší než 180°");return}if(P&&S+P>=180){N(`Součet úhlů musí být menší než 180°. (${P}° + ${S}° = ${P+S}°)`);return}F(!1)}},at=e=>{let t=50*A;for(;t<35;)t*=2;e.strokeStyle=I?"rgba(125, 107, 194, 0.15)":"rgba(229, 231, 235, 0.8)",e.lineWidth=1;const o=M.x%t,s=M.y%t;for(let n=o;n<=k.width;n+=t)e.beginPath(),e.moveTo(n,0),e.lineTo(n,k.height),e.stroke();for(let n=s;n<=k.height;n+=t)e.beginPath(),e.moveTo(0,n),e.lineTo(k.width,n),e.stroke()},le=(e,t,o,s="#000",n=12,a=-12,c=1)=>{e.save(),e.setTransform(c,0,0,c,0,0);const h=t.x*A+M.x,p=t.y*A+M.y;e.font="bold 16px Inter, system-ui, sans-serif";const r=e.measureText(o).width,y=8,f=h+n+r/2,w=p+a-8,B=Math.max(r,16)/2+y;e.fillStyle="#3b82f6",e.beginPath(),e.arc(f,w,B,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff",e.textAlign="center",e.textBaseline="middle",e.fillText(o,f,w),e.restore()},De=(e,t,o,s="#000",n=!1)=>{const a=n?24:20,c=o+Math.PI/2,h={x:t.x+Math.cos(c)*a/2,y:t.y+Math.sin(c)*a/2},p={x:t.x-Math.cos(c)*a/2,y:t.y-Math.sin(c)*a/2};e.strokeStyle=s,e.lineWidth=6,e.lineCap="butt",e.beginPath(),e.moveTo(h.x,h.y),e.lineTo(p.x,p.y),e.stroke(),n&&(e.fillStyle=I?"rgba(96, 165, 250, 0.25)":"rgba(59, 130, 246, 0.15)",e.beginPath(),e.arc(t.x,t.y,18,0,Math.PI*2),e.fill())},Ne=(e,t,o,s="#000")=>{e.fillStyle=I?"rgba(75, 85, 99, 0.4)":"rgba(200, 200, 200, 0.3)",e.beginPath(),e.arc(t.x,t.y,10,0,Math.PI*2),e.fill(),e.fillStyle=s,e.beginPath(),e.arc(t.x,t.y,7,0,Math.PI*2),e.fill(),e.strokeStyle=I?"#111827":"#ffffff",e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,7,0,Math.PI*2),e.stroke()},U=(e,t,o,s,n=1)=>{const a=(t.x+o.x)/2,c=(t.y+o.y)/2,h=o.x-t.x,p=o.y-t.y,u=Math.atan2(p,h);e.save(),e.setTransform(n,0,0,n,0,0);const r=a*A+M.x,y=c*A+M.y;e.translate(r,y),e.rotate(u);const f=`${s}cm`;e.font='600 18px "Fenomen Sans", Arial, sans-serif',e.fillStyle=I?"#e5e7eb":"#1f2937",e.textAlign="center",e.textBaseline="bottom",e.fillText(f,0,-8),e.restore()},C=(e,t,o,s,n=120,a="#fbbf24")=>{const c=o>s;e.strokeStyle="rgba(251, 191, 36, 0.3)",e.lineWidth=16,e.beginPath(),e.arc(t.x,t.y,n,o,s,c),e.stroke(),e.strokeStyle=a,e.lineWidth=6,e.beginPath(),e.arc(t.x,t.y,n,o,s,c),e.stroke();const h=(o+s)/2,p=t.x+Math.cos(h)*n*.5,u=t.y+Math.sin(h)*n*.5;e.fillStyle=a,e.beginPath(),e.arc(p,u,6,0,Math.PI*2),e.fill()},re=(e,t,o,s="#000",n=2,a=1)=>{let c=0;a<=.15?c=0:a>=.85?c=1:c=(a-.15)/.7;const h={x:t.x+(o.x-t.x)*c,y:t.y+(o.y-t.y)*c},p=c<1;p&&c>0&&(e.strokeStyle="rgba(251, 191, 36, 0.5)",e.lineWidth=n*10,e.lineCap="round",e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(h.x,h.y),e.stroke()),c>0&&(e.strokeStyle=s,e.lineWidth=p?n*1.5:n,e.lineCap="round",e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(h.x,h.y),e.stroke())},We=(e,t,o,s,n="#93c5fd",a=4,c=1)=>{let h=0;c<=.15?h=0:c>=.85?h=1:h=(c-.15)/.7;const p={x:t.x+Math.cos(o)*s*h,y:t.y+Math.sin(o)*s*h},u=h<1;u&&h>0&&(e.strokeStyle="rgba(251, 191, 36, 0.5)",e.lineWidth=a*10,e.lineCap="round",e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(p.x,p.y),e.stroke()),h>0&&(e.strokeStyle=n,e.lineWidth=u?a*1.5:a,e.lineCap="round",e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(p.x,p.y),e.stroke())},$e=(e,t,o,s=200,n="#f97316",a=1)=>{e.strokeStyle=n,e.lineWidth=8,e.beginPath(),e.arc(t.x,t.y,s,0,Math.PI*2),e.stroke(),e.strokeStyle=`${n}60`,e.lineWidth=3,e.beginPath(),e.arc(t.x,t.y,s+15,0,Math.PI*2),e.stroke();for(let c=0;c<360;c+=10){const h=c*Math.PI/180,p=c%30===0,r=s-(p?20:10),y=t.x+Math.cos(h)*r,f=t.y+Math.sin(h)*r,w=t.x+Math.cos(h)*s,B=t.y+Math.sin(h)*s;if(e.strokeStyle=n,e.lineWidth=p?3:2,e.beginPath(),e.moveTo(y,f),e.lineTo(w,B),e.stroke(),p){const j=s+35,x=t.x+Math.cos(h)*j,z=t.y+Math.sin(h)*j;e.save(),e.setTransform(a,0,0,a,0,0);const q=x*A+M.x,O=z*A+M.y;e.font='400 12px "Fenomen Sans", Arial, sans-serif',e.fillStyle=n,e.textAlign="center",e.textBaseline="middle",e.fillText(`${c}°`,q,O),e.restore()}}},ee=(e,t,o,s,n=120,a="#fbbf24",c=!1)=>{const h=o>s;if(e.strokeStyle="rgba(251, 191, 36, 0.3)",e.lineWidth=16,e.beginPath(),e.arc(t.x,t.y,n,o,s,h),e.stroke(),e.strokeStyle=a,e.lineWidth=6,e.beginPath(),e.arc(t.x,t.y,n,o,s,h),e.stroke(),c){const u=s,r={x:t.x+Math.cos(u)*n,y:t.y+Math.sin(u)*n},y=h?-1:1;e.fillStyle="rgba(0, 0, 0, 0.2)",e.beginPath(),e.moveTo(r.x+2,r.y+2),e.lineTo(r.x+2+y*24*Math.cos(u-Math.PI/6),r.y+2+y*24*Math.sin(u-Math.PI/6)),e.lineTo(r.x+2+y*24*Math.cos(u+Math.PI/6),r.y+2+y*24*Math.sin(u+Math.PI/6)),e.closePath(),e.fill(),e.fillStyle=a,e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(r.x+y*24*Math.cos(u-Math.PI/6),r.y+y*24*Math.sin(u-Math.PI/6)),e.lineTo(r.x+y*24*Math.cos(u+Math.PI/6),r.y+y*24*Math.sin(u+Math.PI/6)),e.closePath(),e.fill(),e.strokeStyle=a,e.lineWidth=2,e.stroke()}},Pe=(e,t,o,s)=>{if(!T||!Be||!V.current)return;let n=0;if(s<.15)n=s/.15;else if(s>=.15&&s<=.85)n=1;else if(s>.85&&s<1)n=(1-s)/.15;else return;const a=V.current,c=800,h=400;e.save();const p=o.x-t.x,u=o.y-t.y,r=Math.sqrt(p*p+u*u),y=Math.atan2(u,p);e.translate(t.x,t.y),e.rotate(y),e.globalAlpha=n;const f=r/2-c/2;e.drawImage(a,f,-h,c,h),e.restore()},Le=(e,t,o,s)=>{if(!T||!Be||!V.current)return;let n=0;if(s<.15)n=s/.15;else if(s>=.15&&s<=.85)n=1;else if(s>.85&&s<1)n=(1-s)/.15;else return;const a=V.current,c=800,h=400;e.save(),e.translate(t.x,t.y),e.rotate(o),e.globalAlpha=n,e.drawImage(a,200,-h,c,h),e.restore()},Se=(()=>{switch(l){case 0:return{title:"Narýsuj základnu AB",description:X?"Kolik centimetrů má mít základna AB?":`Rýsujeme základnu AB = ${v} cm. Body A a B můžeš přesouvat myší!`,needsInput:X,inputLabel:"Délka základny AB (cm)"};case 1:return{title:"Zadej úhel α při vrcholu A",description:X?"Kolik stupňů má mít úhel α (alfa) při vrcholu A?":`Úhel α při vrcholu A = ${P}°`,needsInput:X,inputLabel:"Úhel α (stupně)"};case 2:return{title:"Narýsuj paprsek z bodu A",description:`Rýsujeme paprsek z bodu A pod úhlem ${P}°`,needsInput:!1};case 3:return{title:"Zadej úhel β při vrcholu B",description:X?"Kolik stupňů má mít úhel β (beta) při vrcholu B?":`Úhel β při vrcholu B = ${S}°`,needsInput:X,inputLabel:"Úhel β (stupně)"};case 4:return{title:"Narýsuj paprsek z bodu B",description:`Rýsujeme paprsek z bodu B pod úhlem ${S}°`,needsInput:!1};case 5:return i?{title:"Označ průsečík jako bod C",description:"Bod, ve kterém se paprsky protly, pojmenujeme C. To je třetí vrchol trojúhelníku.",needsInput:!1}:{title:"Paprsky se neprotly! ❌",description:`Úhly ${P}° a ${S}° netvoří trojúhelník. Součet musí být menší než 180°.`,needsInput:!1,error:!0};case 6:return{title:"Dorýsuj trojúhelník",description:"Spojíme body A-C a B-C. Trojúhelník ABC je hotový!",needsInput:!1};case 7:return{title:"Opsat trojúhelník",description:"Připíšeme délky stran a velikost úhlu C.",needsInput:!1};default:return{title:"",description:"",needsInput:!1}}})(),it=(e,t)=>{const o=window.devicePixelRatio||1;if(!D.current||D.current.width===0||D.current.height===0)return;e.clearRect(0,0,D.current.width,D.current.height),e.save(),e.scale(o,o),at(e),e.translate(M.x,M.y),e.scale(A,A);const s=window.devicePixelRatio||1,n=Math.atan2(g.y-d.y,g.x-d.x),a=I?"#e5e7eb":"#1f2937",c=I?"#93c5fd":"#3b82f6",h=I?"#fca5a5":"#ef4444",p=I?"#6ee7b7":"#10b981",u=I?"#fbbf24":"#f59e0b";if(l>=0&&v&&(re(e,d,g,a,6,l===0&&!X?t:1),l===0&&!X&&T&&Pe(e,d,g,t),(l>0||l===0&&!X&&t>.85)&&T&&U(e,d,g,v,s)),l>=1&&P&&!X){const r=P*Math.PI/180;if(l===1){if(t>.05){const f=Math.min((t-.05)/.15,1);e.globalAlpha=f,$e(e,d,n,200,"#f97316",s),e.globalAlpha=1}const y=t;if(y>.2){const f=n+r*((y-.2)/.8);if((P===90||P===270)&&y>.8?C(e,d,n,f,120,u):ee(e,d,n,f,120,u,!0),y>.5){const B=(f-n)*180/Math.PI,j=160,x=n+(f-n)/2,z=d.x+Math.cos(x)*j,q=d.y+Math.sin(x)*j;e.save(),e.setTransform(s,0,0,s,0,0);const O=z*A+M.x,G=q*A+M.y;e.font='600 20px "Fenomen Sans", Arial, sans-serif',e.fillStyle=u,e.textAlign="center",e.textBaseline="middle",e.fillText(`${Math.round(B)}°`,O,G),e.restore()}}}else if(l>=2&&(P===90||P===270?C(e,d,n,n+r,120,u):ee(e,d,n,n+r,120,u,!1),T)){const w=n+r/2,B=d.x+Math.cos(w)*160,j=d.y+Math.sin(w)*160;e.save(),e.setTransform(s,0,0,s,0,0);const x=B*A+M.x,z=j*A+M.y;e.font='600 20px "Fenomen Sans", Arial, sans-serif',e.fillStyle=u,e.textAlign="center",e.textBaseline="middle",e.fillText(`${P}°`,x,z),e.restore()}}if(l>=2&&P){const r=P*Math.PI/180,y=n+r;We(e,d,y,800,c,4,l===2?t:1),l===2&&T&&Le(e,d,y,t)}if(l>=3&&S&&!X){const r=S*Math.PI/180,y=n+Math.PI-r;if(l===3){if(t>.05){const w=Math.min((t-.05)/.15,1);e.globalAlpha=w,$e(e,g,n+Math.PI,200,"#f97316",s),e.globalAlpha=1}const f=t;if(f>.2){const w=n+Math.PI-r*((f-.2)/.8);if((S===90||S===270)&&f>.8?C(e,g,n+Math.PI,w,120,u):ee(e,g,n+Math.PI,w,120,u,!0),f>.5){const j=(n+Math.PI-w)*180/Math.PI,x=160,z=n+Math.PI-(n+Math.PI-w)/2,q=g.x+Math.cos(z)*x,O=g.y+Math.sin(z)*x;e.save(),e.setTransform(s,0,0,s,0,0);const G=q*A+M.x,we=O*A+M.y;e.font='600 20px "Fenomen Sans", Arial, sans-serif',e.fillStyle=u,e.textAlign="center",e.textBaseline="middle",e.fillText(`${Math.round(j)}°`,G,we),e.restore()}}}else if(l>=4&&(S===90||S===270?C(e,g,n+Math.PI,y,120,u):ee(e,g,n+Math.PI,y,120,u,!1),T)){const B=n+Math.PI-r/2,j=g.x+Math.cos(B)*160,x=g.y+Math.sin(B)*160;e.save(),e.setTransform(s,0,0,s,0,0);const z=j*A+M.x,q=x*A+M.y;e.font='600 20px "Fenomen Sans", Arial, sans-serif',e.fillStyle=u,e.textAlign="center",e.textBaseline="middle",e.fillText(`${S}°`,z,q),e.restore()}}if(l>=4&&S){const r=S*Math.PI/180,y=n+Math.PI-r;We(e,g,y,800,c,4,l===4?t:1),l===4&&T&&Le(e,g,y,t)}if(l>=5&&i&&l===5&&t>.1){const r=Math.min((t-.1)/.3,1);if(r<1){const y=25+r*35;e.strokeStyle=`rgba(251, 191, 36, ${.7*(1-r)})`,e.lineWidth=6,e.beginPath(),e.arc(i.x,i.y,y,0,Math.PI*2),e.stroke();const f=15+r*20;e.strokeStyle=`rgba(251, 191, 36, ${.5*(1-r)})`,e.lineWidth=4,e.beginPath(),e.arc(i.x,i.y,f,0,Math.PI*2),e.stroke()}if(r>.3){const y=Math.min((r-.3)/.4,1),f=25*y;e.strokeStyle=u,e.lineWidth=4,e.globalAlpha=y,e.beginPath(),e.moveTo(i.x-f,i.y),e.lineTo(i.x+f,i.y),e.stroke(),e.beginPath(),e.moveTo(i.x,i.y-f),e.lineTo(i.x,i.y+f),e.stroke(),e.globalAlpha=1}}if(l>=6&&i&&v){const r=t*2;if(r<=1?(re(e,d,i,p,5,r),T&&Pe(e,d,i,r)):(re(e,d,i,p,5,1),re(e,g,i,p,5,r-1),T&&Pe(e,g,i,r-1)),(l>6||l===6&&t>.85)&&T){const y=Math.sqrt(Math.pow(i.x-d.x,2)+Math.pow(i.y-d.y,2)),f=Math.sqrt(Math.pow(i.x-g.x,2)+Math.pow(i.y-g.y,2)),w=Math.sqrt(Math.pow(g.x-d.x,2)+Math.pow(g.y-d.y,2)),B=Math.round(y/w*v*10)/10,j=Math.round(f/w*v*10)/10;U(e,d,i,B,s),U(e,g,i,j,s)}}if(l>=7&&i&&v&&P&&S){const r=Math.sqrt(Math.pow(i.x-d.x,2)+Math.pow(i.y-d.y,2)),y=Math.sqrt(Math.pow(i.x-g.x,2)+Math.pow(i.y-g.y,2)),f=Math.round(r/_*v*10)/10,w=Math.round(y/_*v*10)/10,B=180-P-S;if(T&&(e.globalAlpha=Math.min(t/.3,1),U(e,d,g,v,s),t>.3&&(e.globalAlpha=Math.min((t-.3)/.3,1),U(e,d,i,f,s)),t>.6&&(e.globalAlpha=Math.min((t-.6)/.3,1),U(e,g,i,w,s)),e.globalAlpha=1,t>.8)){const j=Math.min((t-.8)/.2,1);e.globalAlpha=j;const x=Math.atan2(d.y-i.y,d.x-i.x),z=Math.atan2(g.y-i.y,g.x-i.x);B===90||B===270?C(e,i,x,z,80,u):ee(e,i,x,z,80,u,!1);const O=120,G=(x+z)/2,we=i.x+Math.cos(G)*O,mt=i.y+Math.sin(G)*O;e.save(),e.setTransform(s,0,0,s,0,0);const pt=we*A+M.x,ft=mt*A+M.y;e.font='600 20px "Fenomen Sans", Arial, sans-serif',e.fillStyle=u,e.textAlign="center",e.textBaseline="middle",e.fillText(`${B}°`,pt,ft),e.restore(),e.globalAlpha=1}}if(l>=0&&v&&(T&&(De(e,d,n,a,oe==="A"),De(e,g,n,a,oe==="B")),le(e,d,"A",a,-25,-12,s),le(e,g,"B",a,12,-12,s)),l>=5&&i)if(l===5){if(t>.5){const r=Math.min((t-.5)/.3,1);e.globalAlpha=r,Ne(e,i,"C",h),e.globalAlpha=1,r>.4&&le(e,i,"C",h,12,-12,s)}}else Ne(e,i,"C",h),le(e,i,"C",h,12,-12,s);e.restore()};m.useEffect(()=>{const e=L.current,t=D.current;if(!e||!t||e.width===0||e.height===0||t.width===0||t.height===0)return;const o=e.getContext("2d"),s=t.getContext("2d");if(!o||!s)return;it(s,Z),o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,e.width,e.height);const n=Z<.05?Z/.05:1;o.globalAlpha=n,o.drawImage(t,0,0),o.globalAlpha=1},[l,A,M,k,d,g,i,oe,Z,T,I,v,P,S,X]);const lt=e=>{e>l&&(l===0&&!v||l===1&&!P||l===3&&!S||l===5&&!i)||(Ie(e),de(0),ge(!0),F(e===0&&!v||e===1&&!P?!0:e===3&&!S))},rt=e=>{const t=L.current?.getBoundingClientRect();if(!t)return;const o=e.clientX-t.left,s=e.clientY-t.top,n=ie(o,s),a={x:o,y:s};if(W(d,n)||$(d,a,{x:-25,y:-12})){E("A");return}if(W(g,n)||$(g,a,{x:12,y:-12})){E("B");return}if(i&&l>=5&&(W(i,n)||$(i,a,{x:12,y:-12}))){E("C");return}ne(!0),be({x:e.clientX-M.x,y:e.clientY-M.y})},ct=e=>{const t=L.current?.getBoundingClientRect();if(!t)return;const o=e.clientX-t.left,s=e.clientY-t.top,n=ie(o,s),a={x:o,y:s};if(R==="A"){Te(n);return}if(R==="B"){Re(n);return}if(R==="C"){J(n);return}if(ue){K({x:e.clientX-se.x,y:e.clientY-se.y});return}W(d,n)||$(d,a,{x:-25,y:-12})?ae("A"):W(g,n)||$(g,a,{x:12,y:-12})?ae("B"):i&&l>=5&&(W(i,n)||$(i,a,{x:12,y:-12}))?ae("C"):ae(null)},Ee=()=>{ne(!1),E(null)},Fe=(e,t)=>{const o=e.clientX-t.clientX,s=e.clientY-t.clientY;return Math.sqrt(o*o+s*s)},qe=(e,t)=>({x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2}),ht=e=>{const t=L.current?.getBoundingClientRect();if(!t)return;if(e.touches.length===2){const h=Fe(e.touches[0],e.touches[1]),p=qe(e.touches[0],e.touches[1]);xe(!0),Qe(h),et(A),tt(p),e.preventDefault();return}if(e.touches.length!==1)return;const o=e.touches[0],s=o.clientX-t.left,n=o.clientY-t.top,a=ie(s,n),c={x:s,y:n};if(W(d,a)||$(d,c,{x:-25,y:-12})){E("A"),e.preventDefault();return}if(W(g,a)||$(g,c,{x:12,y:-12})){E("B"),e.preventDefault();return}if(i&&l>=5&&(W(i,a)||$(i,c,{x:12,y:-12}))){E("C"),e.preventDefault();return}ne(!0),be({x:o.clientX-M.x,y:o.clientY-M.y}),e.preventDefault()},ut=e=>{const t=L.current?.getBoundingClientRect();if(!t)return;if(e.touches.length===2&&Ve){const c=Fe(e.touches[0],e.touches[1]),h=qe(e.touches[0],e.touches[1]),p=c/Je,u=Math.max(.2,Math.min(.6,Ce*p)),r=h.x-t.left,y=h.y-t.top,f=u/A,w={x:r-(r-M.x)*f,y:y-(y-M.y)*f};he(u),K(w),e.preventDefault();return}if(e.touches.length!==1)return;const o=e.touches[0],s=o.clientX-t.left,n=o.clientY-t.top,a=ie(s,n);if(R==="A"){Te(a),e.preventDefault();return}if(R==="B"){Re(a),e.preventDefault();return}if(R==="C"){J(a),e.preventDefault();return}if(ue){K({x:o.clientX-se.x,y:o.clientY-se.y}),e.preventDefault();return}},Oe=()=>{ne(!1),E(null),xe(!1)},dt=e=>{e.preventDefault();const t=e.deltaY>0?.9:1.1,o=Math.max(.2,Math.min(.6,A*t)),s=L.current?.getBoundingClientRect();if(!s)return;const n=s.width/2,a=s.height/2,c=o/A;K({x:n-(n-M.x)*c,y:a-(a-M.y)*c}),he(o)},gt=()=>R?"grabbing":oe?"move":ue?"grabbing":"grab",yt=()=>{Ie(0),me(null),pe(null),fe(null),J(null),Me(null),N(""),F(!0),de(0),ge(!0),Ye()};return b.jsxs("div",{className:"size-full flex flex-col relative",children:[b.jsx("div",{ref:te,className:`flex-1 ${I?"bg-[#1a1b26]":"bg-white"}`,children:b.jsx("canvas",{ref:L,className:"w-full h-full",style:{cursor:gt(),touchAction:"none"},onMouseDown:rt,onMouseMove:ct,onMouseUp:Ee,onMouseLeave:Ee,onTouchStart:ht,onTouchMove:ut,onTouchEnd:Oe,onTouchCancel:Oe,onWheel:dt})}),b.jsxs("button",{onClick:ve,onTouchEnd:e=>{e.preventDefault(),ve()},className:`absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-2 rounded-xl shadow-[0_2px_12px_rgba(0,0,0,0.08)] transition-all ${I?"bg-[#1a1b26]/90 hover:bg-[#24283b] text-[#c0caf5] border border-[#2a2b3d] backdrop-blur-sm":"bg-white/90 hover:bg-gray-50 border border-gray-200/60 backdrop-blur-sm"}`,children:[b.jsx(Mt,{className:"size-5"}),b.jsx("span",{className:"text-sm font-medium",children:"Menu"})]}),b.jsx("div",{className:`absolute top-4 z-10 transition-all duration-300 ${H?"right-[576px]":"right-4"}`,children:b.jsxs("button",{onClick:()=>ye(!H),onTouchEnd:e=>{e.preventDefault(),ye(!H)},className:`p-3 rounded-xl transition-all relative group/protocol ${H?I?"bg-[#7aa2f7] text-white":"bg-[#1e1b4b] text-white":I?"bg-[#24283b] hover:bg-[#414868] text-[#c0caf5]":"bg-white/90 hover:bg-gray-50 text-gray-700 shadow-[0_2px_12px_rgba(0,0,0,0.08)] border border-gray-200/60 backdrop-blur-sm"}`,title:"Zápis konstrukce",children:[b.jsx(Pt,{className:"size-5"}),!H&&b.jsx("div",{className:"absolute right-0 top-full mt-2 px-3 py-1.5 bg-black/80 text-white text-xs rounded-lg whitespace-nowrap opacity-0 group-hover/protocol:opacity-100 transition-opacity pointer-events-none",children:"Zápis konstrukce"})]})}),Se.needsInput&&b.jsx("div",{className:"absolute inset-0 z-20 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:b.jsxs("div",{className:`w-full max-w-2xl rounded-2xl border-2 p-8 ${I?"bg-[#1f2937] border-gray-600":"bg-white border-gray-200"}`,children:[b.jsx("div",{className:"mb-8",children:b.jsx(St,{value:l===0?v:l===1?P:l===3?S:null,onChange:e=>{l===0?me(e):l===1?pe(e):l===3&&fe(e)},min:0,max:l===0?99:179,step:1,unit:l===0?"cm":"°",darkMode:I,label:Se.title})}),Xe&&b.jsx("div",{className:`p-4 rounded-lg mb-6 ${I?"bg-red-900/30 border border-red-700 text-red-300":"bg-red-50 border border-red-200 text-red-700"}`,children:Xe}),b.jsx("button",{onClick:ot,className:"w-full px-6 py-4 bg-[#2563eb] text-white rounded-xl hover:bg-[#1d4ed8] transition-colors text-lg",children:"Pokračovat"})]})}),b.jsxs("div",{className:`absolute top-4 left-1/2 -translate-x-1/2 z-10 rounded-2xl shadow-lg max-w-2xl ${I?"bg-gray-900 border border-gray-800 text-[#c0caf5]":"bg-white border border-gray-200 text-gray-900"}`,style:{fontFamily:"var(--font-family, 'Fenomen Sans', sans-serif)",padding:"24px 40px"},children:[b.jsxs("div",{className:`text-base font-medium mb-3 ${I?"text-[#565f89]":"text-gray-400"}`,children:["Krok ",l+1," / ",Y.length]}),b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsx("span",{className:"flex items-center justify-center w-10 h-10 rounded-full text-sm font-bold shrink-0",style:{backgroundColor:Y[l]?.type==="circle"?"#f43f5e":Y[l]?.type==="segment"?"#10b981":Y[l]?.type==="line"?"#8b5cf6":Y[l]?.type==="angle"?"#f97316":"#3b82f6",color:"#fff"},children:Y[l]?.type==="circle"?"○":Y[l]?.type==="segment"?"—":Y[l]?.type==="line"?"↔":Y[l]?.type==="angle"?"∠":"•"}),b.jsxs("span",{className:"text-xl font-medium",style:{fontFamily:'"Times New Roman", Georgia, serif',fontStyle:"italic"},children:[l+1,". ",Y[l]?.notation]})]}),b.jsx("div",{className:`text-base mt-2.5 ${I?"text-[#565f89]":"text-gray-500"}`,children:Se.description})]}),b.jsx(wt,{currentStep:l,totalSteps:Y.length,showCaptions:T,darkMode:I,scale:A,onStepChange:lt,onRestart:yt,onToggleCaptions:()=>He(!T),onToggleDarkMode:()=>Ze(!I),onZoomChange:e=>{const t=Math.max(.2,Math.min(.6,e)),o=k.width/2,s=k.height/2,n=(o-M.x)/A,a=(s-M.y)/A;he(t),K({x:o-n*t,y:s-a*t})}}),b.jsx(vt,{steps:Y,currentStep:l,constructionTitle:"Konstrukce trojúhelníku (SUS)",darkMode:I,visible:H,onClose:()=>ye(!1)})]})}export{jt as AngleTriangleConstruction};

import{r as d,j as C,A as et}from"./index-f4ndBCHf.js";import{u as tt}from"./slider-CMbdbvLS.js";import{C as nt}from"./ConstructionControlPanel-CT8jyKdn.js";import"./rotate-ccw-A21KN-ic.js";function ct({onBack:pe,darkMode:g,onDarkModeChange:Re}){const ae=tt(),I=d.useRef(null),A=d.useRef(null),$=d.useRef(null),_=d.useRef(),[w,Te]=d.useState(0),[p,V]=d.useState(ae?.15:.5),[v,x]=d.useState({x:0,y:0}),[ee,U]=d.useState(!1),[G,re]=d.useState({x:0,y:0}),[f,Me]=d.useState({width:1920,height:1080}),[W,te]=d.useState(0),[le,ne]=d.useState(!0),[D,Xe]=d.useState(!0),oe=d.useRef(null),[Ye,Ie]=d.useState(!1),se=d.useRef(null),[Ae,je]=d.useState(!1),[S,ce]=d.useState({x:860,y:840}),[b,he]=d.useState({x:1460,y:840}),[Z,N]=d.useState(null),[M,ie]=d.useState(null),[ue,ke]=d.useState(!1),[We,de]=d.useState(!1),[De,Ee]=d.useState(0),[ze,Le]=d.useState(1),[ot,Ce]=d.useState({x:0,y:0}),ge=Math.sqrt(Math.pow(b.x-S.x,2)+Math.pow(b.y-S.y,2)),j=ge*.7,T=(()=>{const e=(S.x+b.x)/2,t=(S.y+b.y)/2,s=ge,n=s/2,o=Math.sqrt(j*j-n*n),i=b.x-S.x,r=-(b.y-S.y)/s,c=i/s;return{top:{x:e+o*r,y:t+o*c},bottom:{x:e-o*r,y:t-o*c}}})();d.useEffect(()=>{A.current||(A.current=document.createElement("canvas"))},[]),d.useEffect(()=>{const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{oe.current=e,Ie(!0)},e.onerror=()=>{console.error("Failed to load ruler image")},e.src="https://jjpiguuubvmiobmixwgh.supabase.co/storage/v1/object/public/Admin%20math/pravitko4.svg"},[]),d.useEffect(()=>{const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{se.current=e,je(!0)},e.onerror=()=>{console.error("Failed to load compass image")},e.src="https://jjpiguuubvmiobmixwgh.supabase.co/storage/v1/object/public/Admin%20math/kruzitko.svg"},[]);const K=(e,t)=>({x:(e-v.x)/p,y:(t-v.y)/p}),q=(e,t,s=15)=>{const n=e.x-t.x,o=e.y-t.y;return Math.sqrt(n*n+o*o)<s},B=(e,t,s)=>{const n=e.x*p+v.x,o=e.y*p+v.y,i=n+s.x,a=o+s.y,r=20,c=t.x-i,y=t.y-(a-8);return Math.sqrt(c*c+y*y)<r},ye=()=>{if(!f.width||!f.height)return;const e=(S.x+b.x)/2,t=(S.y+b.y)/2,s=f.width/2,n=f.height/2;x({x:s-e*p,y:n-t*p})};d.useEffect(()=>{const e=()=>{$.current&&Me({width:$.current.clientWidth,height:$.current.clientHeight})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),d.useEffect(()=>{f.width>0&&f.height>0&&(ye(),ue||ke(!0))},[f.width,f.height,ue]),d.useEffect(()=>{const e=I.current,t=A.current;if(!e||!t)return;const s=window.devicePixelRatio||1;e.width=f.width*s,e.height=f.height*s,t.width=f.width*s,t.height=f.height*s},[f]),d.useEffect(()=>(le&&W<1?_.current=requestAnimationFrame(()=>{let e=.008;w===1||w===3?e=.002:(w===2||w===4)&&(e=.005),te(t=>Math.min(t+e,1))}):W>=1&&ne(!1),()=>{_.current&&cancelAnimationFrame(_.current)}),[le,W,w]);const xe=e=>{e.strokeStyle=g?"rgba(31, 41, 55, 0.3)":"rgba(229, 231, 235, 0.5)",e.lineWidth=1;for(let s=0;s<=f.width;s+=20)e.beginPath(),e.moveTo(s,0),e.lineTo(s,f.height),e.stroke();for(let s=0;s<=f.height;s+=20)e.beginPath(),e.moveTo(0,s),e.lineTo(f.width,s),e.stroke()},R=(e,t,s,n="#000",o=12,i=-12,a=1)=>{e.save(),e.setTransform(a,0,0,a,0,0);const r=t.x*p+v.x,c=t.y*p+v.y;e.font="600 22px Arial, sans-serif";const h=e.measureText(s).width,u=r+o+h/2,l=c+i-8,m=Math.max(h,16)/2+6;e.fillStyle=g?"rgba(55, 65, 81, 0.5)":"rgba(200, 200, 200, 0.35)",e.beginPath(),e.arc(u,l,m,0,Math.PI*2),e.fill(),e.fillStyle=n,e.fillText(s,r+o,c+i),e.restore()},X=(e,t,s,n="#000",o=!1)=>{const i=o?24:20,a=s+Math.PI/2,r={x:t.x+Math.cos(a)*i/2,y:t.y+Math.sin(a)*i/2},c={x:t.x-Math.cos(a)*i/2,y:t.y-Math.sin(a)*i/2};e.strokeStyle=n,e.lineWidth=6,e.lineCap="butt",e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(c.x,c.y),e.stroke(),o&&(e.fillStyle=g?"rgba(96, 165, 250, 0.25)":"rgba(59, 130, 246, 0.15)",e.beginPath(),e.arc(t.x,t.y,18,0,Math.PI*2),e.fill())},F=(e,t,s,n="#000")=>{e.fillStyle=g?"rgba(75, 85, 99, 0.4)":"rgba(200, 200, 200, 0.3)",e.beginPath(),e.arc(t.x,t.y,10,0,Math.PI*2),e.fill(),e.fillStyle=n,e.beginPath(),e.arc(t.x,t.y,7,0,Math.PI*2),e.fill(),e.strokeStyle=g?"#111827":"#ffffff",e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,7,0,Math.PI*2),e.stroke()},E=(e,t,s,n="#000",o=2,i=1)=>{let a=0;i<=.15?a=0:i>=.85?a=1:a=(i-.15)/.7;const r={x:t.x+(s.x-t.x)*a,y:t.y+(s.y-t.y)*a},c=a<1;c&&a>0&&(e.strokeStyle="rgba(251, 191, 36, 0.5)",e.lineWidth=o*10,e.lineCap="round",e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(r.x,r.y),e.stroke()),a>0&&(e.strokeStyle=n,e.lineWidth=c?o*1.5:o,e.lineCap="round",e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(r.x,r.y),e.stroke())},k=(e,t,s,n="#93c5fd",o=2,i=1)=>{let a=0;i<=.15?a=0:i>=.85?a=1:a=(i-.15)/.7;const r=Math.PI*2*a,c=a<1;c&&a>0&&(e.strokeStyle="rgba(251, 191, 36, 0.5)",e.lineWidth=o*10,e.lineCap="round",e.beginPath(),e.arc(t.x,t.y,s,0,r),e.stroke()),a>0&&(e.strokeStyle=n,e.lineWidth=c?o*1.5:o,e.lineCap="round",e.beginPath(),e.arc(t.x,t.y,s,0,r),e.stroke())},fe=(e,t,s,n)=>{if(!D||!Ye||!oe.current)return;let o=0;if(n<.15)o=n/.15;else if(n>=.15&&n<=.85)o=1;else if(n>.85&&n<1)o=(1-n)/.15;else return;const i=oe.current,a=800,r=400;e.save();const c=s.x-t.x,y=s.y-t.y,h=Math.sqrt(c*c+y*y),u=Math.atan2(y,c);e.translate(t.x,t.y),e.rotate(u),e.globalAlpha=o;const l=h/2-a/2;e.drawImage(i,l,-r,a,r),e.restore()},J=(e,t,s,n,o)=>{if(!D||!Ae||!se.current)return;let i=0;if(n<.15)i=n/.15;else if(n>=.15&&n<=.85)i=1;else if(n>.85&&n<1)i=(1-n)/.15;else return;const a=se.current,r=s,c=s;e.save(),e.translate(t.x,t.y),e.rotate(o),e.globalAlpha=i,e.drawImage(a,0,-c,r,c),e.restore()},Ne=(e,t,s,n="#60a5fa",o=2,i=1,a=0)=>{const r=s.x-t.x,c=s.y-t.y,y=Math.sqrt(r*r+c*c),h=50,u={x:t.x-r/y*h,y:t.y-c/y*h},l={x:s.x+r/y*h,y:s.y+c/y*h},m=Math.sqrt(Math.pow(l.x-u.x,2)+Math.pow(l.y-u.y,2));let P=0;i<=.15?P=0:i>=.85?P=1:P=(i-.15)/.7;const Y=m*P,z={x:u.x+r/y*Y,y:u.y+c/y*Y},O=P<1;O&&P>0&&(e.strokeStyle="rgba(251, 191, 36, 0.5)",e.lineWidth=o*10,e.lineCap="round",e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(z.x,z.y),e.stroke()),P>0&&(e.strokeStyle=n,e.lineWidth=O?o*1.5:o,e.lineCap="round",e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(z.x,z.y),e.stroke())},H=[{id:0,title:"Narýsuj úsečku AB",description:"Začneme s úsečkou AB o délce 6 cm. Body A a B můžeš přesouvat myší!",draw:(e,t,s,n,o,i,a,r,c,y)=>{const h=window.devicePixelRatio||1,u=Math.atan2(o.y-n.y,o.x-n.x),l=g?"#e5e7eb":"#1f2937";E(e,n,o,l,6,r),X(e,n,u,l,M==="A"),X(e,o,u,l,M==="B"),R(e,n,"A",l,-25,-12,h),R(e,o,"B",l,12,-12,h)}},{id:1,title:"Zapíchni kružítko do bodu A",description:"Zapíchneme kružítko do bodu A a vezmeme do něj délku větší než polovina úsečky AB.",draw:(e,t,s,n,o,i,a,r,c,y)=>{const h=window.devicePixelRatio||1,u=Math.atan2(o.y-n.y,o.x-n.x),l=g?"#e5e7eb":"#1f2937",m=g?"#fca5a5":"#ef4444";E(e,n,o,l,6,1),X(e,n,u,m,M==="A"),X(e,o,u,l,M==="B"),R(e,n,"A",m,-25,-12,h),R(e,o,"B",l,12,-12,h)}},{id:2,title:"Narýsuj kružnici z bodu A",description:"S kružítkem zapíchnutým v bodě A narýsujeme kružnici s poloměrem větším než polovina úsečky.",draw:(e,t,s,n,o,i,a,r,c,y)=>{const h=window.devicePixelRatio||1,u=Math.atan2(o.y-n.y,o.x-n.x),l=g?"#e5e7eb":"#1f2937",m=g?"#93c5fd":"#3b82f6";E(e,n,o,l,6,1),k(e,n,i,m,4,r),X(e,n,u,l,M==="A"),X(e,o,u,l,M==="B"),R(e,n,"A",l,-25,-12,h),R(e,o,"B",l,12,-12,h)}},{id:3,title:"Zapíchni kružítko do bodu B",description:"Teď zapíchneme kružítko do bodu B. Velikost (poloměr) v kružítku NEMĚNÍME!",draw:(e,t,s,n,o,i,a,r,c,y)=>{const h=window.devicePixelRatio||1,u=Math.atan2(o.y-n.y,o.x-n.x),l=g?"#e5e7eb":"#1f2937",m=g?"#93c5fd":"#3b82f6",P=g?"#fca5a5":"#ef4444";E(e,n,o,l,6,1),k(e,n,i,m,4,1),X(e,n,u,l,M==="A"),X(e,o,u,P,M==="B"),R(e,n,"A",l,-25,-12,h),R(e,o,"B",P,12,-12,h)}},{id:4,title:"Narýsuj kružnici z bodu B",description:"S kružítkem v bodě B narýsujeme kružnici se stejným poloměrem.",draw:(e,t,s,n,o,i,a,r,c,y)=>{const h=window.devicePixelRatio||1,u=Math.atan2(o.y-n.y,o.x-n.x),l=g?"#e5e7eb":"#1f2937",m=g?"#93c5fd":"#3b82f6";E(e,n,o,l,6,1),k(e,n,i,m,4,1),k(e,o,i,m,4,r),X(e,n,u,l,M==="A"),X(e,o,u,l,M==="B"),R(e,n,"A",l,-25,-12,h),R(e,o,"B",l,12,-12,h)}},{id:5,title:"Označ průsečíky X a Y",description:"Body, ve kterých se kružnice protly, pojmenujeme X a Y.",draw:(e,t,s,n,o,i,a,r,c,y)=>{const h=window.devicePixelRatio||1,u=Math.atan2(o.y-n.y,o.x-n.x),l=g?"#e5e7eb":"#1f2937",m=g?"#93c5fd":"#3b82f6";E(e,n,o,l,6,1),k(e,n,i,m,4,1),k(e,o,i,m,4,1),X(e,n,u,l,M==="A"),X(e,o,u,l,M==="B"),R(e,n,"A",l,-25,-12,h),R(e,o,"B",l,12,-12,h)}},{id:6,title:"Narýsuj osu úsečky",description:"Spojíme body X a Y přímkou. Tato přímka je OSA úsečky AB - je kolmá na AB a prochází jejím středem.",draw:(e,t,s,n,o,i,a,r,c,y)=>{const h=window.devicePixelRatio||1,u=Math.atan2(o.y-n.y,o.x-n.x),l=g?"#e5e7eb":"#1f2937",m=g?"#93c5fd":"#3b82f6",P=g?"#6ee7b7":"#10b981";E(e,n,o,l,6,1),Ne(e,a.top,a.bottom,P,5,r,i),k(e,n,i,m,4,1),k(e,o,i,m,4,1),X(e,n,u,l,M==="A"),X(e,o,u,l,M==="B"),R(e,n,"A",l,-25,-12,h),R(e,o,"B",l,12,-12,h)}}],qe=(e,t)=>{const s=window.devicePixelRatio||1;if(!A.current||A.current.width===0||A.current.height===0)return;if(e.clearRect(0,0,A.current.width,A.current.height),e.save(),e.scale(s,s),xe(e),D){const i=f.width<768;e.fillStyle=g?"#e5e7eb":"#1f2937",e.font=i?"600 20px Arial, sans-serif":"600 28px Arial, sans-serif",e.textAlign="center",e.fillText("Konstrukce osy úsečky",f.width/2,i?40:60),e.font=i?"400 13px Arial, sans-serif":"400 16px Arial, sans-serif";const a=H[w].description,c=e.measureText(a).width,y=i?18:22,h=i?12:16,u=i?180:120;if(i&&c>f.width-40){const l=f.width-40,m=a.split(" "),P=[];let Y="";for(const L of m){const Q=Y?`${Y} ${L}`:L;e.measureText(Q).width>l&&Y?(P.push(Y),Y=L):Y=Q}Y&&P.push(Y);const z=Math.max(...P.map(L=>e.measureText(L).width)),O=P.length*(y+4),Ke=f.width/2-z/2-h,Je=f.height-u-O-h/2,Qe=z+h*2,_e=O+h;e.fillStyle=g?"rgba(31, 41, 55, 0.95)":"rgba(255, 255, 255, 0.95)",e.beginPath(),e.roundRect(Ke,Je,Qe,_e,8),e.fill(),e.fillStyle=g?"#9ca3af":"#4b5563",P.forEach((L,Q)=>{const Pe=f.height-u-O+Q*(y+4)+y;e.fillText(L,f.width/2,Pe)})}else{const l=f.width/2-c/2-h,m=f.height-u-y-h/2,P=c+h*2,Y=y+h;e.fillStyle=g?"rgba(31, 41, 55, 0.95)":"rgba(255, 255, 255, 0.95)",e.beginPath(),e.roundRect(l,m,P,Y,8),e.fill(),e.fillStyle=g?"#9ca3af":"#4b5563",e.fillText(a,f.width/2,f.height-u)}e.textAlign="left"}e.translate(v.x,v.y),e.scale(p,p);for(let i=0;i<w;i++)H[i].draw(e,p,v,S,b,j,T,1,w,H[i].id);if(H[w].draw(e,p,v,S,b,j,T,t,w,H[w].id),D&&t>0){if(w===0)fe(e,S,b,t);else if(w===1)J(e,S,j,t,0);else if(w===2){const i=t>.15?Math.PI*2*((t-.15)/.7):0;J(e,S,j,t,i)}else if(w===3)J(e,b,j,t,0);else if(w===4){const i=t>.15?Math.PI*2*((t-.15)/.7):0;J(e,b,j,t,i)}else if(w===6){const i=T.bottom.x-T.top.x,a=T.bottom.y-T.top.y,r=Math.sqrt(i*i+a*a),c=50,y={x:T.top.x-i/r*c,y:T.top.y-a/r*c},h={x:T.bottom.x+i/r*c,y:T.bottom.y+a/r*c};fe(e,y,h,t)}}const n=g?"#fca5a5":"#ef4444",o=g?"#6ee7b7":"#10b981";if(w>=5){if(w===5&&t>.3){const i=Math.min((t-.3)/.7,1);e.globalAlpha=i,F(e,T.top,"X",n),F(e,T.bottom,"Y",n),e.globalAlpha=1,i>.5&&(R(e,T.top,"X",n,12,-12,s),R(e,T.bottom,"Y",n,12,12,s))}else if(w>=6&&(F(e,T.top,"X",n),F(e,T.bottom,"Y",n),R(e,T.top,"X",n,12,-12,s),R(e,T.bottom,"Y",n,12,12,s),w===6&&t>.6)){const i={x:(S.x+b.x)/2,y:(S.y+b.y)/2},a=Math.min((t-.6)/.4,1);e.globalAlpha=a,F(e,i,"S",o),e.globalAlpha=1,a>.5&&R(e,i,"S",o,12,-12,s)}}e.restore()};d.useEffect(()=>{const e=I.current,t=A.current;if(!e||!t||e.width===0||e.height===0||t.width===0||t.height===0)return;const s=e.getContext("2d"),n=t.getContext("2d");if(!s||!n)return;qe(n,W),s.clearRect(0,0,e.width,e.height);const o=W<.05?W/.05:1;s.globalAlpha=o,s.drawImage(t,0,0),s.globalAlpha=1},[w,p,v,f,S,b,M,W,D,g]);const me=e=>{Te(e),te(0),ne(!0)},Be=e=>{const t=I.current?.getBoundingClientRect();if(!t)return;const s=e.clientX-t.left,n=e.clientY-t.top,o=K(s,n),i={x:s,y:n};if(q(S,o)||B(S,i,{x:-25,y:-12})){N("A");return}if(q(b,o)||B(b,i,{x:12,y:-12})){N("B");return}U(!0),re({x:e.clientX-v.x,y:e.clientY-v.y})},He=e=>{const t=I.current?.getBoundingClientRect();if(!t)return;const s=e.clientX-t.left,n=e.clientY-t.top,o=K(s,n),i={x:s,y:n};if(Z==="A"){ce(o);return}if(Z==="B"){he(o);return}if(ee){x({x:e.clientX-G.x,y:e.clientY-G.y});return}q(S,o)||B(S,i,{x:-25,y:-12})?ie("A"):q(b,o)||B(b,i,{x:12,y:-12})?ie("B"):ie(null)},we=()=>{U(!1),N(null)},Se=(e,t)=>{const s=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(s*s+n*n)},be=(e,t)=>({x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2}),Oe=e=>{const t=I.current?.getBoundingClientRect();if(!t)return;if(e.touches.length===2){const r=Se(e.touches[0],e.touches[1]),c=be(e.touches[0],e.touches[1]);de(!0),Ee(r),Le(p),Ce(c),e.preventDefault();return}if(e.touches.length!==1)return;const s=e.touches[0],n=s.clientX-t.left,o=s.clientY-t.top,i=K(n,o),a={x:n,y:o};if(q(S,i)||B(S,a,{x:-25,y:-12})){N("A"),e.preventDefault();return}if(q(b,i)||B(b,a,{x:12,y:-12})){N("B"),e.preventDefault();return}U(!0),re({x:s.clientX-v.x,y:s.clientY-v.y}),e.preventDefault()},Ze=e=>{const t=I.current?.getBoundingClientRect();if(!t)return;if(e.touches.length===2&&We){const a=Se(e.touches[0],e.touches[1]),r=be(e.touches[0],e.touches[1]),c=a/De,y=Math.max(.15,Math.min(2.25,ze*c)),h=r.x-t.left,u=r.y-t.top,l=y/p,m={x:h-(h-v.x)*l,y:u-(u-v.y)*l};V(y),x(m),e.preventDefault();return}if(e.touches.length!==1)return;const s=e.touches[0],n=s.clientX-t.left,o=s.clientY-t.top,i=K(n,o);if(Z==="A"){ce(i),e.preventDefault();return}if(Z==="B"){he(i),e.preventDefault();return}if(ee){x({x:s.clientX-G.x,y:s.clientY-G.y}),e.preventDefault();return}},ve=()=>{U(!1),N(null),de(!1)},Fe=e=>{e.preventDefault();const t=e.deltaY>0?.9:1.1,s=Math.max(.15,Math.min(2.25,p*t)),n=I.current?.getBoundingClientRect();if(!n)return;const o=n.width/2,i=n.height/2,a=s/p;x({x:o-(o-v.x)*a,y:i-(i-v.y)*a}),V(s)},$e=e=>{const t=e[0]/100,s=I.current?.getBoundingClientRect();if(!s){V(t);return}const n=s.width/2,o=s.height/2,i=t/p;x({x:n-(n-v.x)*i,y:o-(o-v.y)*i}),V(t)},Ve=()=>Z?"grabbing":M?"move":ee?"grabbing":"grab",Ue=()=>{me(0),ye()},Ge=()=>{te(0),ne(!0)};return C.jsxs("div",{className:"size-full flex flex-col relative",children:[C.jsx("div",{ref:$,className:`flex-1 ${g?"bg-[#111827]":"bg-[#f9fafb]"}`,children:C.jsx("canvas",{ref:I,className:"w-full h-full",style:{cursor:Ve(),touchAction:"none"},onMouseDown:Be,onMouseMove:He,onMouseUp:we,onMouseLeave:we,onTouchStart:Oe,onTouchMove:Ze,onTouchEnd:ve,onTouchCancel:ve,onWheel:Fe})}),C.jsx(nt,{currentStep:w,totalSteps:H.length,scale:p,showCaptions:D,darkMode:g,isMobile:ae,onStepChange:me,onPlayStep:Ge,onRestart:Ue,onZoomChange:$e,onToggleCaptions:()=>Xe(!D),onToggleDarkMode:()=>Re(!g)}),C.jsxs("button",{onClick:pe,className:`absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-2 rounded-lg shadow-lg transition-colors ${g?"bg-[#374151] hover:bg-[#404c5e] text-gray-100 border border-gray-600":"bg-white hover:bg-gray-50 border border-gray-200"}`,children:[C.jsx(et,{className:"size-5"}),C.jsx("span",{children:"Menu"})]})]})}export{ct as BisectorConstruction};

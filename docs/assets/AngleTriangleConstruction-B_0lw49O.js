import{r as M,j as L,A as Te}from"./index-BRGJiicw.js";import{u as Re}from"./slider-DpSH4nPl.js";import{B as Be}from"./BigNumberInput-CRA-tSZu.js";import{C as ke}from"./ConstructionControlPanel-CVt4h4Gu.js";import"./rotate-ccw-CNxnNR_N.js";function De({onBack:Vt,darkMode:v,onDarkModeChange:Gt}){const Tt=Re(),E=M.useRef(null),N=M.useRef(null),ot=M.useRef(null),Mt=M.useRef(),[u,Rt]=M.useState(0),[S,it]=M.useState(Tt?.15:.5),[P,Q]=M.useState({x:0,y:0}),[pt,at]=M.useState(!1),[lt,Bt]=M.useState({x:0,y:0}),[f,Jt]=M.useState({width:1920,height:1080}),[K,rt]=M.useState(0),[kt,ct]=M.useState(!0),[j,Qt]=M.useState(!0),C=M.useRef(null),[bt,_t]=M.useState(!1),[g,jt]=M.useState({x:860,y:900}),[d,Xt]=M.useState({x:1460,y:900}),[l,tt]=M.useState(null),[X,H]=M.useState(null),[ht,gt]=M.useState(null),[Yt,xt]=M.useState(!1),[Ct,zt]=M.useState(!1),[te,ee]=M.useState(0),[ne,se]=M.useState(1),[be,oe]=M.useState({x:0,y:0}),[I,Pt]=M.useState(null),[A,At]=M.useState(null),[w,St]=M.useState(null),[Wt,q]=M.useState(""),[Y,Z]=M.useState(!0),[et,wt]=M.useState(null),[ft,ie]=M.useState(null),U=Math.sqrt(Math.pow(d.x-g.x,2)+Math.pow(d.y-g.y,2)),Lt=()=>{if(!A||!w||!I||A+w>=180)return null;const t=Math.atan2(d.y-g.y,d.x-g.x),e=A*Math.PI/180,o=w*Math.PI/180,n=t+e,s=t+Math.PI-o,i=Math.cos(n),c=Math.sin(n),r=Math.cos(s),p=Math.sin(s),h=d.x-g.x,a=d.y-g.y,y=i*-p-c*-r;if(Math.abs(y)<1e-4)return null;const m=(h*-p-a*-r)/y,T=g.x+m*i,B=g.y+m*c;return{x:T,y:B}},ae=(t,e,o)=>{const n=Math.atan2(e.y-t.y,e.x-t.x);let i=Math.atan2(o.y-t.y,o.x-t.x)-n;for(;i<0;)i+=2*Math.PI;for(;i>2*Math.PI;)i-=2*Math.PI;i>Math.PI&&(i=2*Math.PI-i);const c=Math.round(i*180/Math.PI),r=Math.atan2(o.y-e.y,o.x-e.x);let h=n+Math.PI-r;for(;h<0;)h+=2*Math.PI;for(;h>2*Math.PI;)h-=2*Math.PI;h>Math.PI&&(h=2*Math.PI-h);const a=Math.round(h*180/Math.PI);return{alpha:c,beta:a}};M.useEffect(()=>{I&&!et&&U>0&&(wt(U),ie(I))},[I,et,U]),M.useEffect(()=>{if(et&&ft&&(X==="A"||X==="B")){const t=ft/et,e=Math.round(U*t*10)/10;Pt(e)}},[U,X,et,ft]),M.useEffect(()=>{if(!l&&u>=5&&A&&w&&I){const t=Lt();t&&tt(t)}},[u,A,w,g,d,I,l]),M.useEffect(()=>{if(l&&X!=="C"&&(X==="A"||X==="B")&&A&&w&&I){const t=Lt();t&&tt(t)}},[g,d,X,A,w,I,l]),M.useEffect(()=>{if(l&&X==="C"){const t=ae(g,d,l);t.alpha>0&&t.alpha<180&&t.beta>0&&t.beta<180&&(At(t.alpha),St(t.beta))}},[l,g,d,X]),M.useEffect(()=>{N.current||(N.current=document.createElement("canvas"))},[]),M.useEffect(()=>{const t=new Image;t.crossOrigin="anonymous",t.onload=()=>{C.current=t,_t(!0)},t.onerror=()=>console.error("Failed to load ruler image"),t.src="https://jjpiguuubvmiobmixwgh.supabase.co/storage/v1/object/public/Admin%20math/pravitko4.svg"},[]);const ut=(t,e)=>({x:(t-P.x)/S,y:(e-P.y)/S}),F=(t,e,o=15)=>{const n=t.x-e.x,s=t.y-e.y;return Math.sqrt(n*n+s*s)<o},O=(t,e,o)=>{const n=t.x*S+P.x,s=t.y*S+P.y,i=n+o.x,c=s+o.y,r=20,p=e.x-i,h=e.y-(c-8);return Math.sqrt(p*p+h*h)<r},Dt=()=>{if(!f.width||!f.height)return;const t=(g.x+d.x)/2,e=g.y,o=f.width/2,n=f.height/2;Q({x:o-t*S,y:n-e*S})};M.useEffect(()=>{const t=()=>{ot.current&&Jt({width:ot.current.clientWidth,height:ot.current.clientHeight})};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),M.useEffect(()=>{f.width>0&&f.height>0&&(Dt(),Yt||xt(!0))},[f.width,f.height,Yt]),M.useEffect(()=>{const t=E.current,e=N.current;if(!t||!e)return;const o=window.devicePixelRatio||1;t.width=f.width*o,t.height=f.height*o,e.width=f.width*o,e.height=f.height*o},[f]),M.useEffect(()=>(kt&&K<1&&!Y?Mt.current=requestAnimationFrame(()=>{rt(t=>Math.min(t+.008,1))}):K>=1&&ct(!1),()=>{Mt.current&&cancelAnimationFrame(Mt.current)}),[kt,K,Y]);const le=()=>{if(q(""),u===0){if(I===null||I<0){q("Zadej prosím platnou délku (0-99 cm)");return}if(I===0){q("Délka základny musí být větší než 0 cm");return}wt(null),Z(!1)}else if(u===1){if(!A||A<=0){q("Zadej prosím úhel větší než 0°");return}if(A>=180){q("Úhel musí být menší než 180°");return}Z(!1)}else if(u===3){if(!w||w<=0){q("Zadej prosím úhel větší než 0°");return}if(w>=180){q("Úhel musí být menší než 180°");return}if(A&&w+A>=180){q(`Součet úhlů musí být menší než 180°. (${A}° + ${w}° = ${A+w}°)`);return}Z(!1)}},re=t=>{t.strokeStyle=v?"rgba(31, 41, 55, 0.3)":"rgba(229, 231, 235, 0.5)",t.lineWidth=1;for(let o=0;o<=f.width;o+=20)t.beginPath(),t.moveTo(o,0),t.lineTo(o,f.height),t.stroke();for(let o=0;o<=f.height;o+=20)t.beginPath(),t.moveTo(0,o),t.lineTo(f.width,o),t.stroke()},dt=(t,e,o,n="#000",s=12,i=-12,c=1)=>{t.save(),t.setTransform(c,0,0,c,0,0);const r=e.x*S+P.x,p=e.y*S+P.y;t.font="600 22px Arial, sans-serif";const a=t.measureText(o).width,y=r+s+a/2,m=p+i-8,T=Math.max(a,16)/2+6;t.fillStyle=v?"rgba(55, 65, 81, 0.5)":"rgba(200, 200, 200, 0.35)",t.beginPath(),t.arc(y,m,T,0,Math.PI*2),t.fill(),t.fillStyle=n,t.fillText(o,r+s,p+i),t.restore()},$t=(t,e,o,n="#000",s=!1)=>{const i=s?24:20,c=o+Math.PI/2,r={x:e.x+Math.cos(c)*i/2,y:e.y+Math.sin(c)*i/2},p={x:e.x-Math.cos(c)*i/2,y:e.y-Math.sin(c)*i/2};t.strokeStyle=n,t.lineWidth=6,t.lineCap="butt",t.beginPath(),t.moveTo(r.x,r.y),t.lineTo(p.x,p.y),t.stroke(),s&&(t.fillStyle=v?"rgba(96, 165, 250, 0.25)":"rgba(59, 130, 246, 0.15)",t.beginPath(),t.arc(e.x,e.y,18,0,Math.PI*2),t.fill())},Et=(t,e,o,n="#000")=>{t.fillStyle=v?"rgba(75, 85, 99, 0.4)":"rgba(200, 200, 200, 0.3)",t.beginPath(),t.arc(e.x,e.y,10,0,Math.PI*2),t.fill(),t.fillStyle=n,t.beginPath(),t.arc(e.x,e.y,7,0,Math.PI*2),t.fill(),t.strokeStyle=v?"#111827":"#ffffff",t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,7,0,Math.PI*2),t.stroke()},_=(t,e,o,n,s=1)=>{const i=(e.x+o.x)/2,c=(e.y+o.y)/2,r=o.x-e.x,p=o.y-e.y,h=Math.atan2(p,r);t.save(),t.setTransform(s,0,0,s,0,0);const a=i*S+P.x,y=c*S+P.y;t.translate(a,y),t.rotate(h);const m=`${n}cm`;t.font="600 18px Arial, sans-serif",t.fillStyle=v?"#e5e7eb":"#1f2937",t.textAlign="center",t.textBaseline="bottom",t.fillText(m,0,-8),t.restore()},nt=(t,e,o,n,s=120,i="#fbbf24")=>{const c=o>n;t.strokeStyle="rgba(251, 191, 36, 0.3)",t.lineWidth=16,t.beginPath(),t.arc(e.x,e.y,s,o,n,c),t.stroke(),t.strokeStyle=i,t.lineWidth=6,t.beginPath(),t.arc(e.x,e.y,s,o,n,c),t.stroke();const r=(o+n)/2,p=e.x+Math.cos(r)*s*.5,h=e.y+Math.sin(r)*s*.5;t.fillStyle=i,t.beginPath(),t.arc(p,h,6,0,Math.PI*2),t.fill()},yt=(t,e,o,n="#000",s=2,i=1)=>{let c=0;i<=.15?c=0:i>=.85?c=1:c=(i-.15)/.7;const r={x:e.x+(o.x-e.x)*c,y:e.y+(o.y-e.y)*c},p=c<1;p&&c>0&&(t.strokeStyle="rgba(251, 191, 36, 0.5)",t.lineWidth=s*10,t.lineCap="round",t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(r.x,r.y),t.stroke()),c>0&&(t.strokeStyle=n,t.lineWidth=p?s*1.5:s,t.lineCap="round",t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(r.x,r.y),t.stroke())},Nt=(t,e,o,n,s="#93c5fd",i=4,c=1)=>{let r=0;c<=.15?r=0:c>=.85?r=1:r=(c-.15)/.7;const p={x:e.x+Math.cos(o)*n*r,y:e.y+Math.sin(o)*n*r},h=r<1;h&&r>0&&(t.strokeStyle="rgba(251, 191, 36, 0.5)",t.lineWidth=i*10,t.lineCap="round",t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(p.x,p.y),t.stroke()),r>0&&(t.strokeStyle=s,t.lineWidth=h?i*1.5:i,t.lineCap="round",t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(p.x,p.y),t.stroke())},qt=(t,e,o,n=200,s="#f97316",i=1)=>{t.strokeStyle=s,t.lineWidth=8,t.beginPath(),t.arc(e.x,e.y,n,0,Math.PI*2),t.stroke(),t.strokeStyle=`${s}60`,t.lineWidth=3,t.beginPath(),t.arc(e.x,e.y,n+15,0,Math.PI*2),t.stroke();for(let c=0;c<360;c+=10){const r=c*Math.PI/180,p=c%30===0,a=n-(p?20:10),y=e.x+Math.cos(r)*a,m=e.y+Math.sin(r)*a,T=e.x+Math.cos(r)*n,B=e.y+Math.sin(r)*n;if(t.strokeStyle=s,t.lineWidth=p?3:2,t.beginPath(),t.moveTo(y,m),t.lineTo(T,B),t.stroke(),p){const k=n+35,R=e.x+Math.cos(r)*k,b=e.y+Math.sin(r)*k;t.save(),t.setTransform(i,0,0,i,0,0);const D=R*S+P.x,$=b*S+P.y;t.font="400 12px Arial, sans-serif",t.fillStyle=s,t.textAlign="center",t.textBaseline="middle",t.fillText(`${c}°`,D,$),t.restore()}}},st=(t,e,o,n,s=120,i="#fbbf24",c=!1)=>{const r=o>n;if(t.strokeStyle="rgba(251, 191, 36, 0.3)",t.lineWidth=16,t.beginPath(),t.arc(e.x,e.y,s,o,n,r),t.stroke(),t.strokeStyle=i,t.lineWidth=6,t.beginPath(),t.arc(e.x,e.y,s,o,n,r),t.stroke(),c){const h=n,a={x:e.x+Math.cos(h)*s,y:e.y+Math.sin(h)*s},y=r?-1:1;t.fillStyle="rgba(0, 0, 0, 0.2)",t.beginPath(),t.moveTo(a.x+2,a.y+2),t.lineTo(a.x+2+y*24*Math.cos(h-Math.PI/6),a.y+2+y*24*Math.sin(h-Math.PI/6)),t.lineTo(a.x+2+y*24*Math.cos(h+Math.PI/6),a.y+2+y*24*Math.sin(h+Math.PI/6)),t.closePath(),t.fill(),t.fillStyle=i,t.beginPath(),t.moveTo(a.x,a.y),t.lineTo(a.x+y*24*Math.cos(h-Math.PI/6),a.y+y*24*Math.sin(h-Math.PI/6)),t.lineTo(a.x+y*24*Math.cos(h+Math.PI/6),a.y+y*24*Math.sin(h+Math.PI/6)),t.closePath(),t.fill(),t.strokeStyle=i,t.lineWidth=2,t.stroke()}},vt=(t,e,o,n)=>{if(!j||!bt||!C.current)return;let s=0;if(n<.15)s=n/.15;else if(n>=.15&&n<=.85)s=1;else if(n>.85&&n<1)s=(1-n)/.15;else return;const i=C.current,c=800,r=400;t.save();const p=o.x-e.x,h=o.y-e.y,a=Math.sqrt(p*p+h*h),y=Math.atan2(h,p);t.translate(e.x,e.y),t.rotate(y),t.globalAlpha=s;const m=a/2-c/2;t.drawImage(i,m,-r,c,r),t.restore()},Ft=(t,e,o,n)=>{if(!j||!bt||!C.current)return;let s=0;if(n<.15)s=n/.15;else if(n>=.15&&n<=.85)s=1;else if(n>.85&&n<1)s=(1-n)/.15;else return;const i=C.current,c=800,r=400;t.save(),t.translate(e.x,e.y),t.rotate(o),t.globalAlpha=s,t.drawImage(i,200,-r,c,r),t.restore()},V=(()=>{switch(u){case 0:return{title:"Narýsuj základnu AB",description:Y?"Kolik centimetrů má mít základna AB?":`Rýsujeme základnu AB = ${I} cm. Body A a B můžeš přesouvat myší!`,needsInput:Y,inputLabel:"Délka základny AB (cm)"};case 1:return{title:"Zadej úhel α při vrcholu A",description:Y?"Kolik stupňů má mít úhel α (alfa) při vrcholu A?":`Úhel α při vrcholu A = ${A}°`,needsInput:Y,inputLabel:"Úhel α (stupně)"};case 2:return{title:"Narýsuj paprsek z bodu A",description:`Rýsujeme paprsek z bodu A pod úhlem ${A}°`,needsInput:!1};case 3:return{title:"Zadej úhel β při vrcholu B",description:Y?"Kolik stupňů má mít úhel β (beta) při vrcholu B?":`Úhel β při vrcholu B = ${w}°`,needsInput:Y,inputLabel:"Úhel β (stupně)"};case 4:return{title:"Narýsuj paprsek z bodu B",description:`Rýsujeme paprsek z bodu B pod úhlem ${w}°`,needsInput:!1};case 5:return l?{title:"Označ průsečík jako bod C",description:"Bod, ve kterém se paprsky protly, pojmenujeme C. To je třetí vrchol trojúhelníku.",needsInput:!1}:{title:"Paprsky se neprotly! ❌",description:`Úhly ${A}° a ${w}° netvoří trojúhelník. Součet musí být menší než 180°.`,needsInput:!1,error:!0};case 6:return{title:"Dorýsuj trojúhelník",description:"Spojíme body A-C a B-C. Trojúhelník ABC je hotový!",needsInput:!1};case 7:return{title:"Opsat trojúhelník",description:"Připíšeme délky stran a velikost úhlu C.",needsInput:!1};default:return{title:"",description:"",needsInput:!1}}})(),ce=(t,e)=>{const o=window.devicePixelRatio||1;if(!N.current||N.current.width===0||N.current.height===0)return;if(t.clearRect(0,0,N.current.width,N.current.height),t.save(),t.scale(o,o),re(t),j){const a=f.width<768;t.fillStyle=v?"#e5e7eb":"#1f2937",t.font=a?"600 20px Arial, sans-serif":"600 28px Arial, sans-serif",t.textAlign="center";const y=I?`Trojúhelník z úhlů (AB=${I}cm)`:"Trojúhelník z úhlů";t.fillText(y,f.width/2,a?40:60),t.font=a?"400 13px Arial, sans-serif":"400 16px Arial, sans-serif";const m=V.description,B=t.measureText(m).width,k=a?18:22,R=a?12:16,b=a?180:120;if(a&&B>f.width-40){const D=f.width-40,$=m.split(" "),z=[];let W="";for(const J of $){const mt=W?`${W} ${J}`:J;t.measureText(mt).width>D&&W?(z.push(W),W=J):W=mt}W&&z.push(W);const x=Math.max(...z.map(J=>t.measureText(J).width)),G=z.length*(k+4),It=f.width/2-x/2-R,Se=f.height-b-G-R/2,we=x+R*2,fe=G+R,ve=V.error?v?"rgba(220, 38, 38, 0.2)":"rgba(254, 202, 202, 0.95)":v?"rgba(31, 41, 55, 0.95)":"rgba(255, 255, 255, 0.95)";t.fillStyle=ve,t.beginPath(),t.roundRect(It,Se,we,fe,8),t.fill();const Ie=V.error?v?"#fca5a5":"#dc2626":v?"#9ca3af":"#4b5563";t.fillStyle=Ie,z.forEach((J,mt)=>{const Ut=f.height-b-G+mt*(k+4)+k;t.fillText(J,f.width/2,Ut)})}else{const D=f.width/2-B/2-R,$=f.height-b-k-R/2,z=B+R*2,W=k+R,x=V.error?v?"rgba(220, 38, 38, 0.2)":"rgba(254, 202, 202, 0.95)":v?"rgba(31, 41, 55, 0.95)":"rgba(255, 255, 255, 0.95)";t.fillStyle=x,t.beginPath(),t.roundRect(D,$,z,W,8),t.fill();const G=V.error?v?"#fca5a5":"#dc2626":v?"#9ca3af":"#4b5563";t.fillStyle=G,t.fillText(m,f.width/2,f.height-b)}t.textAlign="left"}t.translate(P.x,P.y),t.scale(S,S);const n=window.devicePixelRatio||1,s=Math.atan2(d.y-g.y,d.x-g.x),i=v?"#e5e7eb":"#1f2937",c=v?"#93c5fd":"#3b82f6",r=v?"#fca5a5":"#ef4444",p=v?"#6ee7b7":"#10b981",h=v?"#fbbf24":"#f59e0b";if(u>=0&&I&&(yt(t,g,d,i,6,u===0&&!Y?e:1),u===0&&!Y&&j&&vt(t,g,d,e),(u>0||u===0&&!Y&&e>.85)&&j&&_(t,g,d,I,n)),u>=1&&A&&!Y){const a=A*Math.PI/180;if(u===1){if(e>.05){const m=Math.min((e-.05)/.15,1);t.globalAlpha=m,qt(t,g,s,200,"#f97316",n),t.globalAlpha=1}const y=e;if(y>.2){const m=s+a*((y-.2)/.8);if((A===90||A===270)&&y>.8?nt(t,g,s,m,120,h):st(t,g,s,m,120,h,!0),y>.5){const B=(m-s)*180/Math.PI,k=160,R=s+(m-s)/2,b=g.x+Math.cos(R)*k,D=g.y+Math.sin(R)*k;t.save(),t.setTransform(n,0,0,n,0,0);const $=b*S+P.x,z=D*S+P.y;t.font="600 20px Arial, sans-serif",t.fillStyle=h,t.textAlign="center",t.textBaseline="middle",t.fillText(`${Math.round(B)}°`,$,z),t.restore()}}}else if(u>=2&&(A===90||A===270?nt(t,g,s,s+a,120,h):st(t,g,s,s+a,120,h,!1),j)){const T=s+a/2,B=g.x+Math.cos(T)*160,k=g.y+Math.sin(T)*160;t.save(),t.setTransform(n,0,0,n,0,0);const R=B*S+P.x,b=k*S+P.y;t.font="600 20px Arial, sans-serif",t.fillStyle=h,t.textAlign="center",t.textBaseline="middle",t.fillText(`${A}°`,R,b),t.restore()}}if(u>=2&&A){const a=A*Math.PI/180,y=s+a;Nt(t,g,y,800,c,4,u===2?e:1),u===2&&j&&Ft(t,g,y,e)}if(u>=3&&w&&!Y){const a=w*Math.PI/180,y=s+Math.PI-a;if(u===3){if(e>.05){const T=Math.min((e-.05)/.15,1);t.globalAlpha=T,qt(t,d,s+Math.PI,200,"#f97316",n),t.globalAlpha=1}const m=e;if(m>.2){const T=s+Math.PI-a*((m-.2)/.8);if((w===90||w===270)&&m>.8?nt(t,d,s+Math.PI,T,120,h):st(t,d,s+Math.PI,T,120,h,!0),m>.5){const k=(s+Math.PI-T)*180/Math.PI,R=160,b=s+Math.PI-(s+Math.PI-T)/2,D=d.x+Math.cos(b)*R,$=d.y+Math.sin(b)*R;t.save(),t.setTransform(n,0,0,n,0,0);const z=D*S+P.x,W=$*S+P.y;t.font="600 20px Arial, sans-serif",t.fillStyle=h,t.textAlign="center",t.textBaseline="middle",t.fillText(`${Math.round(k)}°`,z,W),t.restore()}}}else if(u>=4&&(w===90||w===270?nt(t,d,s+Math.PI,y,120,h):st(t,d,s+Math.PI,y,120,h,!1),j)){const B=s+Math.PI-a/2,k=d.x+Math.cos(B)*160,R=d.y+Math.sin(B)*160;t.save(),t.setTransform(n,0,0,n,0,0);const b=k*S+P.x,D=R*S+P.y;t.font="600 20px Arial, sans-serif",t.fillStyle=h,t.textAlign="center",t.textBaseline="middle",t.fillText(`${w}°`,b,D),t.restore()}}if(u>=4&&w){const a=w*Math.PI/180,y=s+Math.PI-a;Nt(t,d,y,800,c,4,u===4?e:1),u===4&&j&&Ft(t,d,y,e)}if(u>=5&&l&&u===5&&e>.1){const a=Math.min((e-.1)/.3,1);if(a<1){const y=25+a*35;t.strokeStyle=`rgba(251, 191, 36, ${.7*(1-a)})`,t.lineWidth=6,t.beginPath(),t.arc(l.x,l.y,y,0,Math.PI*2),t.stroke();const m=15+a*20;t.strokeStyle=`rgba(251, 191, 36, ${.5*(1-a)})`,t.lineWidth=4,t.beginPath(),t.arc(l.x,l.y,m,0,Math.PI*2),t.stroke()}if(a>.3){const y=Math.min((a-.3)/.4,1),m=25*y;t.strokeStyle=h,t.lineWidth=4,t.globalAlpha=y,t.beginPath(),t.moveTo(l.x-m,l.y),t.lineTo(l.x+m,l.y),t.stroke(),t.beginPath(),t.moveTo(l.x,l.y-m),t.lineTo(l.x,l.y+m),t.stroke(),t.globalAlpha=1}}if(u>=6&&l&&I){const a=e*2;if(a<=1?(yt(t,g,l,p,5,a),j&&vt(t,g,l,a)):(yt(t,g,l,p,5,1),yt(t,d,l,p,5,a-1),j&&vt(t,d,l,a-1)),(u>6||u===6&&e>.85)&&j){const y=Math.sqrt(Math.pow(l.x-g.x,2)+Math.pow(l.y-g.y,2)),m=Math.sqrt(Math.pow(l.x-d.x,2)+Math.pow(l.y-d.y,2)),T=Math.sqrt(Math.pow(d.x-g.x,2)+Math.pow(d.y-g.y,2)),B=Math.round(y/T*I*10)/10,k=Math.round(m/T*I*10)/10;_(t,g,l,B,n),_(t,d,l,k,n)}}if(u>=7&&l&&I&&A&&w){const a=Math.sqrt(Math.pow(l.x-g.x,2)+Math.pow(l.y-g.y,2)),y=Math.sqrt(Math.pow(l.x-d.x,2)+Math.pow(l.y-d.y,2)),m=Math.round(a/U*I*10)/10,T=Math.round(y/U*I*10)/10,B=180-A-w;if(j&&(t.globalAlpha=Math.min(e/.3,1),_(t,g,d,I,n),e>.3&&(t.globalAlpha=Math.min((e-.3)/.3,1),_(t,g,l,m,n)),e>.6&&(t.globalAlpha=Math.min((e-.6)/.3,1),_(t,d,l,T,n)),t.globalAlpha=1,e>.8)){const k=Math.min((e-.8)/.2,1);t.globalAlpha=k;const R=Math.atan2(g.y-l.y,g.x-l.x),b=Math.atan2(d.y-l.y,d.x-l.x);B===90||B===270?nt(t,l,R,b,80,h):st(t,l,R,b,80,h,!1);const $=120,z=(R+b)/2,W=l.x+Math.cos(z)*$,x=l.y+Math.sin(z)*$;t.save(),t.setTransform(n,0,0,n,0,0);const G=W*S+P.x,It=x*S+P.y;t.font="600 20px Arial, sans-serif",t.fillStyle=h,t.textAlign="center",t.textBaseline="middle",t.fillText(`${B}°`,G,It),t.restore(),t.globalAlpha=1}}if(u>=0&&I&&(j&&($t(t,g,s,i,ht==="A"),$t(t,d,s,i,ht==="B")),dt(t,g,"A",i,-25,-12,n),dt(t,d,"B",i,12,-12,n)),u>=5&&l)if(u===5){if(e>.5){const a=Math.min((e-.5)/.3,1);t.globalAlpha=a,Et(t,l,"C",r),t.globalAlpha=1,a>.4&&dt(t,l,"C",r,12,-12,n)}}else Et(t,l,"C",r),dt(t,l,"C",r,12,-12,n);t.restore()};M.useEffect(()=>{const t=E.current,e=N.current;if(!t||!e||t.width===0||t.height===0||e.width===0||e.height===0)return;const o=t.getContext("2d"),n=e.getContext("2d");if(!o||!n)return;ce(n,K),o.clearRect(0,0,t.width,t.height);const s=K<.05?K/.05:1;o.globalAlpha=s,o.drawImage(e,0,0),o.globalAlpha=1},[u,S,P,f,g,d,l,ht,K,j,v,I,A,w,Y]);const he=t=>{t>u&&(u===0&&!I||u===1&&!A||u===3&&!w||u===5&&!l)||(Rt(t),rt(0),ct(!0),Z(t===0&&!I||t===1&&!A?!0:t===3&&!w))},ge=t=>{const e=E.current?.getBoundingClientRect();if(!e)return;const o=t.clientX-e.left,n=t.clientY-e.top,s=ut(o,n),i={x:o,y:n};if(F(g,s)||O(g,i,{x:-25,y:-12})){H("A");return}if(F(d,s)||O(d,i,{x:12,y:-12})){H("B");return}if(l&&u>=5&&(F(l,s)||O(l,i,{x:12,y:-12}))){H("C");return}at(!0),Bt({x:t.clientX-P.x,y:t.clientY-P.y})},ue=t=>{const e=E.current?.getBoundingClientRect();if(!e)return;const o=t.clientX-e.left,n=t.clientY-e.top,s=ut(o,n),i={x:o,y:n};if(X==="A"){jt(s);return}if(X==="B"){Xt(s);return}if(X==="C"){tt(s);return}if(pt){Q({x:t.clientX-lt.x,y:t.clientY-lt.y});return}F(g,s)||O(g,i,{x:-25,y:-12})?gt("A"):F(d,s)||O(d,i,{x:12,y:-12})?gt("B"):l&&u>=5&&(F(l,s)||O(l,i,{x:12,y:-12}))?gt("C"):gt(null)},Ot=()=>{at(!1),H(null)},Ht=(t,e)=>{const o=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.sqrt(o*o+n*n)},Zt=(t,e)=>({x:(t.clientX+e.clientX)/2,y:(t.clientY+e.clientY)/2}),de=t=>{const e=E.current?.getBoundingClientRect();if(!e)return;if(t.touches.length===2){const r=Ht(t.touches[0],t.touches[1]),p=Zt(t.touches[0],t.touches[1]);zt(!0),ee(r),se(S),oe(p),t.preventDefault();return}if(t.touches.length!==1)return;const o=t.touches[0],n=o.clientX-e.left,s=o.clientY-e.top,i=ut(n,s),c={x:n,y:s};if(F(g,i)||O(g,c,{x:-25,y:-12})){H("A"),t.preventDefault();return}if(F(d,i)||O(d,c,{x:12,y:-12})){H("B"),t.preventDefault();return}if(l&&u>=5&&(F(l,i)||O(l,c,{x:12,y:-12}))){H("C"),t.preventDefault();return}at(!0),Bt({x:o.clientX-P.x,y:o.clientY-P.y}),t.preventDefault()},ye=t=>{const e=E.current?.getBoundingClientRect();if(!e)return;if(t.touches.length===2&&Ct){const c=Ht(t.touches[0],t.touches[1]),r=Zt(t.touches[0],t.touches[1]),p=c/te,h=Math.max(.15,Math.min(2.25,ne*p)),a=r.x-e.left,y=r.y-e.top,m=h/S,T={x:a-(a-P.x)*m,y:y-(y-P.y)*m};it(h),Q(T),t.preventDefault();return}if(t.touches.length!==1)return;const o=t.touches[0],n=o.clientX-e.left,s=o.clientY-e.top,i=ut(n,s);if(X==="A"){jt(i),t.preventDefault();return}if(X==="B"){Xt(i),t.preventDefault();return}if(X==="C"){tt(i),t.preventDefault();return}if(pt){Q({x:o.clientX-lt.x,y:o.clientY-lt.y}),t.preventDefault();return}},Kt=()=>{at(!1),H(null),zt(!1)},me=t=>{t.preventDefault();const e=t.deltaY>0?.9:1.1,o=Math.max(.15,Math.min(2.25,S*e)),n=E.current?.getBoundingClientRect();if(!n)return;const s=n.width/2,i=n.height/2,c=o/S;Q({x:s-(s-P.x)*c,y:i-(i-P.y)*c}),it(o)},Me=t=>{const e=t[0]/100,o=E.current?.getBoundingClientRect();if(!o){it(e);return}const n=o.width/2,s=o.height/2,i=e/S;Q({x:n-(n-P.x)*i,y:s-(s-P.y)*i}),it(e)},pe=()=>X?"grabbing":ht?"move":pt?"grabbing":"grab",Pe=()=>{Rt(0),Pt(null),At(null),St(null),tt(null),wt(null),q(""),Z(!0),rt(0),ct(!0),Dt()},Ae=()=>{rt(0),ct(!0)};return L.jsxs("div",{className:"size-full flex flex-col relative",children:[L.jsx("div",{ref:ot,className:`flex-1 ${v?"bg-[#111827]":"bg-[#f9fafb]"}`,children:L.jsx("canvas",{ref:E,className:"w-full h-full",style:{cursor:pe(),touchAction:"none"},onMouseDown:ge,onMouseMove:ue,onMouseUp:Ot,onMouseLeave:Ot,onTouchStart:de,onTouchMove:ye,onTouchEnd:Kt,onTouchCancel:Kt,onWheel:me})}),L.jsxs("button",{onClick:Vt,className:`absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-2 rounded-lg shadow-lg transition-colors ${v?"bg-[#374151] hover:bg-[#404c5e] text-gray-100 border border-gray-600":"bg-white hover:bg-gray-50 border border-gray-200"}`,children:[L.jsx(Te,{className:"size-5"}),L.jsx("span",{children:"Menu"})]}),V.needsInput&&L.jsx("div",{className:"absolute inset-0 z-20 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:L.jsxs("div",{className:`w-full max-w-2xl rounded-2xl border-2 p-8 ${v?"bg-[#1f2937] border-gray-600":"bg-white border-gray-200"}`,children:[L.jsx("div",{className:"mb-8",children:L.jsx(Be,{value:u===0?I:u===1?A:u===3?w:null,onChange:t=>{u===0?Pt(t):u===1?At(t):u===3&&St(t)},min:0,max:u===0?99:179,step:1,unit:u===0?"cm":"°",darkMode:v,label:V.title})}),Wt&&L.jsx("div",{className:`p-4 rounded-lg mb-6 ${v?"bg-red-900/30 border border-red-700 text-red-300":"bg-red-50 border border-red-200 text-red-700"}`,children:Wt}),L.jsx("button",{onClick:le,className:"w-full px-6 py-4 bg-[#2563eb] text-white rounded-xl hover:bg-[#1d4ed8] transition-colors text-lg",children:"Pokračovat"})]})}),L.jsx(ke,{currentStep:u,totalSteps:8,scale:S,showCaptions:j,darkMode:v,isMobile:Tt,onStepChange:he,onPlayStep:Ae,onRestart:Pe,onZoomChange:Me,onToggleCaptions:()=>Qt(!j),onToggleDarkMode:()=>Gt(!v)})]})}export{De as AngleTriangleConstruction};
